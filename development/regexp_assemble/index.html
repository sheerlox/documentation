<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.97.3"><meta name=description content="CoreRuleSet Documentation"><meta name=author content="CoreRuleSet"><link rel=icon href=/documentation/images/favicon.png type=image/png><title>regexp-assemble :: Core Rule Set Documentation</title><link href=/documentation/css/nucleus.css?1655566854 rel=stylesheet><link href=/documentation/css/fontawesome-all.min.css?1655566854 rel=stylesheet><link href=/documentation/css/featherlight.min.css?1655566854 rel=stylesheet><link href=/documentation/css/perfect-scrollbar.min.css?1655566854 rel=stylesheet><link href=/documentation/css/auto-complete.css?1655566854 rel=stylesheet><link href=/documentation/css/theme.css?1655566854 rel=stylesheet><link href=/documentation/css/theme-blue.css?1655566854 rel=stylesheet><link href=/documentation/css/variant.css?1655566854 rel=stylesheet><link href=/documentation/css/print.css?1655566854 rel=stylesheet media=print><script src=/documentation/js/jquery.min.js?1655566854></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/documentation/development/regexp_assemble/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://coreruleset.github.io/documentation/><img src=https://coreruleset.github.io/documentation//images/logo.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script src=/documentation/js/lunr.min.js?1655566854></script>
<script src=/documentation/js/auto-complete.js?1655566854></script>
<script>var index_url="/documentation/index.json",root_url="/",baseUri=root_url.replace(/\/$/,'')</script><script src=/documentation/js/search.js?1655566854></script></div><div id=homelinks><ul><li><a class=padding href=/documentation/><i class="fas fa-home"></i> Home</a></li></ul></div><div class=highlightable><ul class=topics><li data-nav-id=/documentation/deployment/ title="Getting CRS" class=dd-item><a href=/documentation/deployment/><b>1. </b>Getting CRS<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/deployment/engine_integration_options/ title="Engine and Integration Options" class=dd-item><a href=/documentation/deployment/engine_integration_options/>Engine and Integration Options<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/deployment/quick_start/ title="Quick Start Guide" class=dd-item><a href=/documentation/deployment/quick_start/>Quick Start Guide<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/deployment/install/ title="Extended Install" class=dd-item><a href=/documentation/deployment/install/>Extended Install<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/concepts/ title="How CRS Works" class=dd-item><a href=/documentation/concepts/><b>2. </b>How CRS Works<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/concepts/anomaly_scoring/ title="Anomaly Scoring" class=dd-item><a href=/documentation/concepts/anomaly_scoring/>Anomaly Scoring<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/paranoia_levels/ title="Paranoia Levels" class=dd-item><a href=/documentation/concepts/paranoia_levels/>Paranoia Levels<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/false_positives_tuning/ title="False Positives and Tuning" class=dd-item><a href=/documentation/concepts/false_positives_tuning/>False Positives and Tuning<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/plugins/ title="Plugin Mechanism" class=dd-item><a href=/documentation/concepts/plugins/>Plugin Mechanism<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/sampling_mode/ title="Sampling Mode" class=dd-item><a href=/documentation/concepts/sampling_mode/>Sampling Mode<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/operation/ title=Operation class=dd-item><a href=/documentation/operation/><b>3. </b>Operation<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/operation/known_issues/ title="Known Issues" class=dd-item><a href=/documentation/operation/known_issues/>Known Issues<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/operation/containers/ title="Using Containers" class=dd-item><a href=/documentation/operation/containers/>Using Containers<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/operation/log_handling/ title="Log Handling" class=dd-item><a href=/documentation/operation/log_handling/>Log Handling<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/rules/ title=Rules class=dd-item><a href=/documentation/rules/><b>4. </b>Rules<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/rules/ruleid/ title="Rule IDs" class=dd-item><a href=/documentation/rules/ruleid/>Rule IDs<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/rules/ title=Rules class=dd-item><a href=/documentation/rules/rules/>Rules<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/creating/ title=Making class=dd-item><a href=/documentation/rules/creating/>Making<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/metadata/ title=Metadata class=dd-item><a href=/documentation/rules/metadata/>Metadata<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/development/ title=Development class="dd-item parent"><a href=/documentation/development/><b>5. </b>Development<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/development/contribution_guidelines/ title="Contribution Guidelines" class=dd-item><a href=/documentation/development/contribution_guidelines/>Contribution Guidelines<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/regexp_assemble/ title=regexp-assemble class="dd-item active"><a href=/documentation/development/regexp_assemble/>regexp-assemble<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/rule_writing/ title="Writing Rules" class=dd-item><a href=/documentation/development/rule_writing/>Writing Rules<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/useful_tools/ title="Useful Tools" class=dd-item><a href=/documentation/development/useful_tools/>Useful Tools<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/testing/ title="Testing the Rule Set" class=dd-item><a href=/documentation/development/testing/>Testing the Rule Set<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/plugin_writing/ title="Writing Plugins" class=dd-item><a href=/documentation/development/plugin_writing/>Writing Plugins<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/sandbox/ title="Using the CRS Sandbox" class=dd-item><a href=/documentation/development/sandbox/>Using the CRS Sandbox<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/resources/ title="Additional Resources" class=dd-item><a href=/documentation/resources/><b>6. </b>Additional Resources<i class="fas fa-check read-icon"></i></a><ul></ul></li><li data-nav-id=/documentation/miscellaneous/ title=Miscellaneous class=dd-item><a href=/documentation/miscellaneous/><b>7. </b>Miscellaneous<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/miscellaneous/self_contained_mode/ title="Self-Contained Mode" class=dd-item><a href=/documentation/miscellaneous/self_contained_mode/>Self-Contained Mode<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><div id=shortcuts><div class=nav-title>More</div><ul><li><a class=padding href=https://coreruleset.org/><i class="fas fa-bookmark"></i> Core Rule Set Home</a></li><li><a class=padding href=https://github.com/coreruleset/coreruleset><i class="fab fa-github"></i> Core Rule Set GitHub</a></li></ul></div><div id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></div><div id=footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></nav><div id=body><div id=overlay></div><div class="padding highlightable"><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/coreruleset/documentation/blob/main/content/development/regexp_assemble.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>regexp-assemble</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#set-up>Set up</a></li><li><a href=#example-use>Example use</a></li><li><a href=#adjusting-the-logging-level>Adjusting the Logging Level</a></li><li><a href=#data-file-format>Data file format</a><ul><li><a href=#example>Example</a></li><li><a href=#comments>Comments</a></li><li><a href=#empty-lines>Empty lines</a></li><li><a href=#flag-marker>Flag marker</a></li><li><a href=#prefix-marker>Prefix marker</a></li><li><a href=#suffix-marker>Suffix marker</a></li><li><a href=#preprocessor-marker>Preprocessor marker</a></li><li><a href=#nesting>Nesting</a></li></ul></li><li><a href=#command-line-evasion-preprocessor>Command line evasion preprocessor</a><ul><li><a href=#arguments>Arguments</a></li><li><a href=#output>Output</a></li><li><a href=#description>Description</a></li></ul></li><li><a href=#assemble-preprocessor>Assemble preprocessor</a><ul><li><a href=#arguments-1>Arguments</a></li><li><a href=#output-1>Output</a></li><li><a href=#description-1>Description</a></li></ul></li><li><a href=#template-preprocessor>Template preprocessor</a><ul><li><a href=#arguments-2>Arguments</a></li><li><a href=#output-2>Output</a></li><li><a href=#description-2>Description</a></li></ul></li><li><a href=#include-preprocessor>Include preprocessor</a><ul><li><a href=#arguments-3>Arguments</a></li><li><a href=#output-3>Output</a></li><li><a href=#description-3>Description</a></li></ul></li></ul></nav></div></div></div><div id=head-tags></div><main id=body-inner><h1>regexp-assemble</h1><h2 id=introduction>Introduction</h2><p>regexp-assemble is a toolset that helps the CRS developers maintain the regular expressions in the rules. Its core functionality (owed to the great <a href=https://github.com/ronsavage/Regexp-Assemble>Regexp:Assemble</a> Perl module) is to assemble individual parts of a regular expression into a single expression (with some optimizations).</p><h2 id=set-up>Set up</h2><ol><li><p>You will need a Perl environment and Perl version >= 5.10</p></li><li><p>You will need a Python environment with Python version >= 3</p></li><li><p>Initialize the Git submodule with the Regexp::Assemble Perl module by running:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git submodule update --init util/regexp-assemble/lib/lib
</span></span></code></pre></div></li><li><p>You need to install some dependencies. With <code>virtualenv</code>, installing them would look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virtualenv -p <span style=color:#ae81ff>3</span> venv
</span></span><span style=display:flex><span>source venv/bin/activate
</span></span><span style=display:flex><span>pip install -r util/regexp-assemble/requirements.txt
</span></span></code></pre></div></li><li><p>You should now be able to use the script. Try running something like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>printf <span style=color:#e6db74>&#34;(?:homer)? simpson\n(?:lisa)? simpson&#34;</span> | util/regexp-assemble/regexp-assemble.py generate -
</span></span></code></pre></div><p>You should see:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>?:<span style=color:#f92672>(</span>?:homer<span style=color:#f92672>)</span>?|<span style=color:#f92672>(</span>?:lisa<span style=color:#f92672>)</span>?<span style=color:#f92672>)</span> simpson
</span></span></code></pre></div></li></ol><h2 id=example-use>Example use</h2><p>To generate a reduced expression from a list of expressions, simply pass the rule ID to the script or pipe the contents to it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>util/regexp-assemble/regexp-assemble.py generate <span style=color:#ae81ff>942170</span>
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span>cat util/regexp-assemble/data/942170.data | util/regexp-assemble/regexp-assemble.py generate -
</span></span></code></pre></div><p>You can also compare generated expressions to the current expressions in the rule files:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>util/regexp-assemble/regexp-assemble.py compare <span style=color:#ae81ff>942170</span>
</span></span></code></pre></div><p>Even better, you can update rule files directly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>util/regexp-assemble/regexp-assemble.py update <span style=color:#ae81ff>942170</span>
</span></span><span style=display:flex><span><span style=color:#75715e># or update all</span>
</span></span><span style=display:flex><span>util/regexp-assemble/regexp-assemble.py update --all
</span></span></code></pre></div><p>Read the help for the full documentation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>util/regexp-assemble/regexp-assemble.py --help
</span></span></code></pre></div><h2 id=adjusting-the-logging-level>Adjusting the Logging Level</h2><p>The level of logging can be adjusted with the <code>--loglevel</code> option, accepted values are <code>DEBUG</code>, <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code>, and <code>CRITICAL</code>.</p><p>Not many things are currently written to the log, so it may seem that changing the logging level doesn&rsquo;t have any effect, especially, since the processing modules depend on the rule the script processes and the command that is being run (e.g. <code>generate</code> usually produces no output since stdout is used to print the resulting regular expression). The <code>cmdline</code> processor, for example, includes debug log output, but the <code>assemble</code> prorcessor currently doesn&rsquo;t.</p><h2 id=data-file-format>Data file format</h2><p>The data files (<code>.data</code> suffix, under <code>util/regexp-assemble/data</code>) contain one regular expression per line. These files are meant to be processed by <a href=regexp-assemble.py>regexp-assemble.py</a>.</p><h3 id=example>Example</h3><p>The following is an example of what a data file might contain:</p><pre tabindex=0><code>##! This line is a comment and will be ignored. The next line is empty and will also be ignored.

##! The next line sets the *ignore case* flag on the resulting expression:
##!+ i

##! The next line is the prefix comment. The assembled expression will be prefixed with its contents:
##!^ \b

##! The next line is the suffix comment. The assembled expression will be suffixed with its contents:
##!$ \W*(

##! The following two lines are regular expressions that will be assembled:
--a--
__b__

##! Another comment, followed by another regular expression:
^#!/bin/bash
</code></pre><p>This data file would produce the following assembled expression: <code>(?i)\b(?:^#!\/bin\/bash|--a--|__b__)\W*(</code></p><h3 id=comments>Comments</h3><p>Lines starting with <code>##!</code> are considered comments and will be skipped. Use comments to explain the purpose of a particular
regular expression, use cases, origin, shortcomings, etc. The more information we have about individual expressions the better we will be able to understand changes or change requirements, e.g. when reviewing pull requests.</p><h3 id=empty-lines>Empty lines</h3><p>Empty lines, i.e., lines containing only white space, will be skipped. You can use empty lines to improve readability, especially when adding
comments.</p><h3 id=flag-marker>Flag marker</h3><p>A line starting with <code>##!+</code> can be used to pass global flags to the script. The last found flag comment line overwrites
all previous flag comment lines. The resulting expression will be prefixed with the flags. For example, the two lines</p><pre tabindex=0><code>##!+ i
a+b|c
</code></pre><p>will produce the regular expression <code>(?i)a+b|c</code>.</p><p>We currently only support the ignore case flag <code>i</code>.</p><h3 id=prefix-marker>Prefix marker</h3><p>A line starting with <code>##!^</code> can be used to pass a global prefix to the script. The resulting expression will be prefixed with the literal contents of the line. Multiple prefix lines will be concatenated in order. For example, the
lines</p><pre tabindex=0><code>##!^ \W*\(
##!^ two
a+b|c
d
</code></pre><p>will produce the regular expression <code>\W*\(two(?:a+b|c|d)</code>.</p><p>The prefix marker exists for convenience and improved readability. The same can be achieved with the <a href=#assemble-preprocessor>assemble preprocessor</a>.</p><h3 id=suffix-marker>Suffix marker</h3><p>A line starting with <code>##!$</code> can be used to pass a suffix to the script. The last found suffix comment line overwrites all previous suffix comment lines. The resulting expression will be suffixed with the literal contents of the line.
For example, the two lines</p><pre tabindex=0><code>##!$ \W*\(
##!$ two
a+b|c
d
</code></pre><p>will produce the regular expression <code>(?:a+b|c|d)\W*\(two</code>.</p><p>The suffix marker exists for convenience and improved readability. The same can be achieved with the <a href=#assemble-preprocessor>assemble preprocessor</a>.</p><h3 id=preprocessor-marker>Preprocessor marker</h3><p>A line starting with <code>##!></code> is a preprocessor directive. The preprocessor marker can be used to preprocess a block of lines.
A line starting with <code>##!&lt;</code> marks the end of the most recent preprocessor.</p><p>Processor markers have the following general format: <code>&lt;marker> &lt;processor name>[&lt;processor arguments>]</code>.
Example: <code>##!> cmdline unix</code>.
The arguments depend on the preprocessor and may be empty.</p><p>Preprocessors are defined in the <a href=regexp-assemble.py>regexp-assemble.py</a> script. Whenever a preprocessor runs, the concerning markers are consumed (not passed on to any subsequently running script), all other markers are left in tact.</p><h3 id=nesting>Nesting</h3><p>Preprocessors may be nested. This enables complex scenarios, such as assembling a smaller expression to concatenate it to another line of block of lines. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>##!&gt; assemble</span>
</span></span><span style=display:flex><span>line1
</span></span><span style=display:flex><span><span style=color:#75715e>##!=&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>##!&gt; assemble</span>
</span></span><span style=display:flex><span>ab
</span></span><span style=display:flex><span>cd
</span></span><span style=display:flex><span>  <span style=color:#75715e>##!&lt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##!&lt;</span>
</span></span></code></pre></div><p>There is no practical limit to the nesting depth. Each preprocess block must be ended with the end marker <code>##!&lt;</code>, except for the outermost block, where the end marker is optional.</p><h2 id=command-line-evasion-preprocessor>Command line evasion preprocessor</h2><p>Processor name: <code>cmdline</code></p><h3 id=arguments>Arguments</h3><ul><li><code>unix|windows</code> (required): The processor argument determines the escaping strategy used for the regular expression. Currently, the two supported strategies are Windows cmd (<code>windows</code>) and &ldquo;unix like&rdquo; terminal (<code>unix</code>).</li></ul><h3 id=output>Output</h3><p>One line per line of input, escaped for the specified environment.</p><h3 id=description>Description</h3><p>The command line evasion preprocessor processes the entire file. Each line is treated as a word (e.g. shell command) that needs to be escaped.</p><p>Lines starting with a single quote <code>'</code> are treated as literals and will not be escaped.</p><p>The special token <code>@</code> will be replaced with the expression <code>(?:\s|&lt;|>).*</code> in <code>unix</code> mode and <code>(?:[\s,;]|\.|/|&lt;|>).*</code> in <code>windows</code> mode. This can be used in the context of shell to reduce the number of of false positives for a word by requiring a subsequent token to be present. Example: <code>diff@</code>.</p><h2 id=assemble-preprocessor>Assemble preprocessor</h2><p>Processor name: <code>assemble</code></p><h3 id=arguments-1>Arguments</h3><p>This preprocessor does not accept any arguments.</p><h3 id=output-1>Output</h3><p>Single line regular expression, where each line of the input is treated as an alternation of the regular expression. Input can also be concatenated by using the two marker comments for input <code>##!=&lt;</code> and <code>##!=></code> output.</p><h3 id=description-1>Description</h3><p>Each line of the input is treated as an alternation of a regular expression, processed into a single line. The resulting regular expression is not optimized (in the strict sense) but reduced (i.e., common elements may be put into character classes or groups). The ordering of alternations in the output can differ from the order in the file (ordering alternations by length is a simple performance optimization).</p><p>This processor can also produce the concatenation of blocks delimited with <code>##!=></code>. It supports two special markers, one for output (<code>##!=></code>) and one for input (<code>##!=&lt;</code>).</p><p>Lines within blocks delimited by input or output markers are treated as alternations, as usual. The input and output markers enables more complex scenarios, such as separating parts of the regular expression in the data file for improved readability. Rule 930100, for example, uses separate expressions for periods and slashes, since it&rsquo;s easier to reason about the differences when they are physically separated. The following example is based on rules from 930100:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>##!&gt; assemble</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##! slash patterns</span>
</span></span><span style=display:flex><span>\x5c
</span></span><span style=display:flex><span><span style=color:#75715e>##! URI encoded</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#ae81ff>2</span>f
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#ae81ff>5</span>c
</span></span><span style=display:flex><span><span style=color:#75715e>##!=&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##! dot patterns</span>
</span></span><span style=display:flex><span>\<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>\<span style=color:#f92672>.%</span><span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>\<span style=color:#f92672>.%</span><span style=color:#ae81ff>01</span>
</span></span></code></pre></div><p>The above would produce the following, concatenated regular expression:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>(<span style=color:#960050;background-color:#1e0010>?</span>:<span style=color:#f92672>%</span>(<span style=color:#960050;background-color:#1e0010>?</span>:<span style=color:#ae81ff>2</span>f<span style=color:#f92672>|</span><span style=color:#ae81ff>5</span>c)<span style=color:#f92672>|</span>\x5c)\<span style=color:#f92672>.</span>(<span style=color:#960050;background-color:#1e0010>?</span>:<span style=color:#f92672>%</span><span style=color:#ae81ff>0</span>[<span style=color:#ae81ff>01</span>])<span style=color:#960050;background-color:#1e0010>?</span>
</span></span></code></pre></div><p>The input marker <code>##!=&lt;</code> takes an identifier as parameter and associates the associated block with the identifier. No output is produced when using the input <code>##!=&lt;</code> marker. To concatenate the output of a previously stored block, the appropriate identifier must be passed to the output marker <code>##!=></code> as argument. Stored blocks remain in storage until the end of the program and are available globally. However, since preprocessors run from innermost nesting level to outermost, the following would produce an error because the input <code>myinput</code> hasn&rsquo;t been stored yet:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>##!&gt; assemble</span>
</span></span><span style=display:flex><span>ab
</span></span><span style=display:flex><span><span style=color:#75715e>##!=&lt; myinput</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>##!&gt; assemble</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>##!=&gt; myinput</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>##!&lt;</span>
</span></span></code></pre></div><p>Storing the input earlier works and produces the expect ouput <code>ab</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>##!&gt; assemble</span>
</span></span><span style=display:flex><span>ab
</span></span><span style=display:flex><span><span style=color:#75715e>##!=&lt; myinput</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##!&lt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##!&gt; assemble</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##!=&gt; myinput</span>
</span></span></code></pre></div><p>Rule 930100 requires the following concatenation of rules: <code>&lt;slash rules>&lt;dot rules>&lt;slash rules></code>, <code>slash rules</code> is concatenated twice. The following example produces this sequence by storing the expression for slashes with the identifier <code>slashes</code>, thus avoiding duplication:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>##!&gt; assemble</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##! slash patterns</span>
</span></span><span style=display:flex><span>\x5c
</span></span><span style=display:flex><span><span style=color:#75715e>##! URI encoded</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#ae81ff>2</span>f
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#ae81ff>5</span>c
</span></span><span style=display:flex><span><span style=color:#75715e>##!=&lt; slashes</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##!=&gt; slashes</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##! dot patterns</span>
</span></span><span style=display:flex><span>\<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>\<span style=color:#f92672>.%</span><span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>\<span style=color:#f92672>.%</span><span style=color:#ae81ff>01</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##!=&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##!=&gt; slashes</span>
</span></span></code></pre></div><h2 id=template-preprocessor>Template preprocessor</h2><p>Processor name: <code>template</code></p><h3 id=arguments-2>Arguments</h3><ul><li>identifier (required): The name of the template that will be processed by this preprocessor</li><li>replacement (required): The string that replaces the template identified by <code>identifier</code></li></ul><h3 id=output-2>Output</h3><p>One line per line of input, with all template strings replaced with the specified replacement.</p><h3 id=description-2>Description</h3><p>The template processor makes it easy to add recurring strings to expressions. This helps reduce maintenance when a template needs to be updated and it improves readability as template strings provide readable and bounded information, where otherwise a regular expression must be read and boundaries must be identified.</p><p>The format of template strings is as follows:</p><pre tabindex=0><code>{{identifier}}
</code></pre><p>The template string starts with two opening braces, is followed by an identifier, and ened with two closing braces. The identifier format must satisfy the following regular expression:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>[a<span style=color:#f92672>-</span>z<span style=color:#f92672>-</span>A<span style=color:#f92672>-</span>Z\d_<span style=color:#f92672>-</span>]<span style=color:#f92672>+</span>
</span></span></code></pre></div><p>An identifier must have at least one character and consist only of upper and lowercase letters a through z, digits 0 through 9, and underscore or dash.</p><p>The following example shows how to use the template processor:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>##!&gt; template slashes [/\]</span>
</span></span><span style=display:flex><span>regex <span style=color:#66d9ef>with</span> {{slashes}}
</span></span></code></pre></div><p>This would result in the output <code>regex with [\/\]</code> (the assembler escapes the forward slash).</p><h2 id=include-preprocessor>Include preprocessor</h2><p>Processor name: <code>include</code></p><h3 id=arguments-3>Arguments</h3><ul><li>include file name (required): The name of the file to include, without suffix</li></ul><h3 id=output-3>Output</h3><p>The exact contents of the included file.</p><h3 id=description-3>Description</h3><p>The incluce preprocessor reduces repetition across data files. Repeated blocks can be put into a file in the <code>include</code> directory and then be included with the <code>include</code> preprocessor comment. The contents of an include file could for example be the alternation of accepted HTTP headers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>POST
</span></span><span style=display:flex><span>GET
</span></span><span style=display:flex><span>HEAD
</span></span></code></pre></div><p>This could be included into a data file for a rule that adds an additional method:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>##!&gt; include http-headers</span>
</span></span><span style=display:flex><span>OPTIONS
</span></span></code></pre></div><p>The resulting regular expression would be <code>(?:(?:POS|GE)T|OPTIONS|HEAD)</code>.</p><p>Note that the include preprocessor does not have a body, therefore, the end marker is optional.</p><footer class=footline></footer></main></div><div id=navigation><a class="nav nav-prev" href=/documentation/development/contribution_guidelines/ title="Contribution Guidelines"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/documentation/development/rule_writing/ title="Writing Rules"><i class="fa fa-chevron-right"></i></a></div></div><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/documentation/js/clipboard.min.js?1655566854></script>
<script src=/documentation/js/perfect-scrollbar.min.js?1655566854></script>
<script src=/documentation/js/perfect-scrollbar.jquery.min.js?1655566854></script>
<script src=/documentation/js/jquery.svg.pan.zoom.js?1655566854></script>
<script src=/documentation/js/featherlight.min.js?1655566854></script>
<script src=/documentation/js/modernizr.custom-3.6.0.js?1655566854></script>
<script src=/documentation/js/mermaid.min.js?1655566854></script>
<script>typeof mermaid!="undefined"&&mermaid.mermaidAPI.initialize(Object.assign({securityLevel:"antiscript"},JSON.parse('{ "startOnLoad": true }'),{startOnLoad:!1}))</script><script src=/documentation/js/relearn.js?1655566854></script>
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://piwik.netnea.com/matomo/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","4"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script><img referrerpolicy=no-referrer-when-downgrade src="https://piwik.netnea.com/matomo/matomo.php?idsite=4&rec=1" style=border:0 alt></body></html>