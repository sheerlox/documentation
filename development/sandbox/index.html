<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.97.3"><meta name=description content="CoreRuleSet Documentation"><meta name=author content="CoreRuleSet"><link rel=icon href=/documentation/images/favicon.png type=image/png><title>Using the CRS Sandbox :: Core Rule Set Documentation</title><link href=/documentation/css/nucleus.css?1685100206 rel=stylesheet><link href=/documentation/css/fontawesome-all.min.css?1685100206 rel=stylesheet><link href=/documentation/css/featherlight.min.css?1685100206 rel=stylesheet><link href=/documentation/css/perfect-scrollbar.min.css?1685100206 rel=stylesheet><link href=/documentation/css/auto-complete.css?1685100206 rel=stylesheet><link href=/documentation/css/theme.css?1685100206 rel=stylesheet><link href=/documentation/css/theme-blue.css?1685100206 rel=stylesheet><link href=/documentation/css/variant.css?1685100206 rel=stylesheet><link href=/documentation/css/print.css?1685100206 rel=stylesheet media=print><script src=/documentation/js/jquery.min.js?1685100206></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/documentation/development/sandbox/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://coreruleset.github.io/documentation/><img src=https://coreruleset.github.io/documentation//images/logo.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script src=/documentation/js/lunr.min.js?1685100206></script>
<script src=/documentation/js/auto-complete.js?1685100206></script>
<script>var index_url="/documentation/index.json",root_url="/",baseUri=root_url.replace(/\/$/,'')</script><script src=/documentation/js/search.js?1685100206></script></div><div id=homelinks><ul><li><a class=padding href=/documentation/><i class="fas fa-home"></i> Home</a></li></ul></div><div class=highlightable><ul class=topics><li data-nav-id=/documentation/deployment/ title="Getting CRS" class=dd-item><a href=/documentation/deployment/><b>1. </b>Getting CRS<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/deployment/engine_integration_options/ title="Engine and Integration Options" class=dd-item><a href=/documentation/deployment/engine_integration_options/>Engine and Integration Options<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/deployment/quick_start/ title="Quick Start Guide" class=dd-item><a href=/documentation/deployment/quick_start/>Quick Start Guide<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/deployment/install/ title="Extended Install" class=dd-item><a href=/documentation/deployment/install/>Extended Install<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/concepts/ title="How CRS Works" class=dd-item><a href=/documentation/concepts/><b>2. </b>How CRS Works<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/concepts/anomaly_scoring/ title="Anomaly Scoring" class=dd-item><a href=/documentation/concepts/anomaly_scoring/>Anomaly Scoring<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/paranoia_levels/ title="Paranoia Levels" class=dd-item><a href=/documentation/concepts/paranoia_levels/>Paranoia Levels<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/false_positives_tuning/ title="False Positives and Tuning" class=dd-item><a href=/documentation/concepts/false_positives_tuning/>False Positives and Tuning<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/plugins/ title="Plugin Mechanism" class=dd-item><a href=/documentation/concepts/plugins/>Plugin Mechanism<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/sampling_mode/ title="Sampling Mode" class=dd-item><a href=/documentation/concepts/sampling_mode/>Sampling Mode<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/operation/ title=Operation class=dd-item><a href=/documentation/operation/><b>3. </b>Operation<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/operation/known_issues/ title="Known Issues" class=dd-item><a href=/documentation/operation/known_issues/>Known Issues<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/operation/containers/ title="Using Containers" class=dd-item><a href=/documentation/operation/containers/>Using Containers<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/operation/kubernetes_ingress/ title="Kubernetes Ingress Controllers" class=dd-item><a href=/documentation/operation/kubernetes_ingress/>Kubernetes Ingress Controllers<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/operation/log_handling/ title="Log Handling" class=dd-item><a href=/documentation/operation/log_handling/>Log Handling<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/rules/ title=Rules class=dd-item><a href=/documentation/rules/><b>4. </b>Rules<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/rules/ruleid/ title="Rule IDs" class=dd-item><a href=/documentation/rules/ruleid/>Rule IDs<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/rules/ title=Rules class=dd-item><a href=/documentation/rules/rules/>Rules<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/creating/ title=Making class=dd-item><a href=/documentation/rules/creating/>Making<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/metadata/ title=Metadata class=dd-item><a href=/documentation/rules/metadata/>Metadata<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/development/ title=Development class="dd-item parent"><a href=/documentation/development/><b>5. </b>Development<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/development/contribution_guidelines/ title="Contribution Guidelines" class=dd-item><a href=/documentation/development/contribution_guidelines/>Contribution Guidelines<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/crs_toolchain/ title=crs-toolchain class=dd-item><a href=/documentation/development/crs_toolchain/>crs-toolchain<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/regex_assembly/ title="Assembling Regular Expressions" class=dd-item><a href=/documentation/development/regex_assembly/>Assembling Regular Expressions<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/rule_writing/ title="Writing Rules" class=dd-item><a href=/documentation/development/rule_writing/>Writing Rules<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/useful_tools/ title="Useful Tools" class=dd-item><a href=/documentation/development/useful_tools/>Useful Tools<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/testing/ title="Testing the Rule Set" class=dd-item><a href=/documentation/development/testing/>Testing the Rule Set<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/plugin_writing/ title="Writing Plugins" class=dd-item><a href=/documentation/development/plugin_writing/>Writing Plugins<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/sandbox/ title="Using the CRS Sandbox" class="dd-item active"><a href=/documentation/development/sandbox/>Using the CRS Sandbox<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/resources/ title="Additional Resources" class=dd-item><a href=/documentation/resources/><b>6. </b>Additional Resources<i class="fas fa-check read-icon"></i></a><ul></ul></li><li data-nav-id=/documentation/miscellaneous/ title=Miscellaneous class=dd-item><a href=/documentation/miscellaneous/><b>7. </b>Miscellaneous<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/miscellaneous/self_contained_mode/ title="Self-Contained Mode" class=dd-item><a href=/documentation/miscellaneous/self_contained_mode/>Self-Contained Mode<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><div id=shortcuts><div class=nav-title>More</div><ul><li><a class=padding href=https://coreruleset.org/><i class="fas fa-bookmark"></i> Core Rule Set Home</a></li><li><a class=padding href=https://github.com/coreruleset/coreruleset><i class="fab fa-github"></i> Core Rule Set GitHub</a></li></ul></div><div id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></div><div id=footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></nav><div id=body><div id=overlay></div><div class="padding highlightable"><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/coreruleset/documentation/blob/main/content/development/sandbox.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>Using the CRS Sandbox</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#introducing-the-crs-sandbox>Introducing the CRS Sandbox</a></li><li><a href=#basic-usage>Basic usage</a><ul><li><a href=#example>Example</a></li><li><a href=#example-showing-the-response-headers>Example showing the response headers</a></li></ul></li><li><a href=#default-options>Default options</a></li><li><a href=#changing-options>Changing options</a><ul><li><a href=#advanced-examples>Advanced examples</a></li></ul></li><li><a href=#capacity>Capacity</a></li><li><a href=#architecture>Architecture</a></li><li><a href=#known-issues>Known issues</a></li><li><a href=#questions-and-suggestions>Questions and suggestions</a></li><li><a href=#working-on-the-sandbox-adding-new-backends>Working on the sandbox: adding new backends</a></li></ul></nav></div></div></div><div id=head-tags></div><main id=body-inner><h1>Using the CRS Sandbox</h1><h2 id=introducing-the-crs-sandbox>Introducing the CRS Sandbox</h2><p>We have set up a public <strong>CRS Sandbox</strong> which you can use to send attacks at the CRS. You can choose between various WAF engines and CRS versions. The sandbox parses audit logs and returns our detections in an easy and useful format.</p><p>The sandbox is useful for:</p><ul><li>integrators and administrators: you can test out our response in case of an urgent security event, such as the Log4j vulnerability;</li><li>exploit developers/researchers: if you have devised a payload, you can test beforehand if it will be blocked by the CRS and by which versions;</li><li>CRS developers/rule writers: you can quickly check if the CRS catches a (variant of an) exploit without the hassle of setting up your own CRS instance.</li></ul><h2 id=basic-usage>Basic usage</h2><p>The sandbox is located at <a href=https://sandbox.coreruleset.org/>https://sandbox.coreruleset.org/</a>.</p><p>An easy way to use the sandbox is to send requests to it with <code>curl</code>, although you can use any HTTPS client.</p><p>The sandbox has many options, which you can change by adding HTTP headers to your request. One is very important so we will explain it first; this is the <code>X-Format-Output: txt-matched-rules</code> header. If you add this header to your request, the sandbox will parse the WAF’s output, and return to you the matched CRS rule IDs with descriptions, and the score for your request.</p><h3 id=example>Example</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -H <span style=color:#e6db74>&#34;x-format-output: txt-matched-rules&#34;</span> https://sandbox.coreruleset.org/?file<span style=color:#f92672>=</span>/etc/passwd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>930120</span> PL1 OS File Access Attempt
</span></span><span style=display:flex><span><span style=color:#ae81ff>932160</span> PL1 Remote Command Execution: Unix Shell Code Found
</span></span><span style=display:flex><span><span style=color:#ae81ff>949110</span> PL1 Inbound Anomaly Score Exceeded <span style=color:#f92672>(</span>Total Score: 10<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>980130</span> PL1 Inbound Anomaly Score Exceeded <span style=color:#f92672>(</span>Total Inbound Score: <span style=color:#ae81ff>10</span> - SQLI<span style=color:#f92672>=</span>0,XSS<span style=color:#f92672>=</span>0,RFI<span style=color:#f92672>=</span>0,LFI<span style=color:#f92672>=</span>5,RCE<span style=color:#f92672>=</span>5,PHPI<span style=color:#f92672>=</span>0,HTTP<span style=color:#f92672>=</span>0,SESS<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>: individual paranoia level scores: 10, 0, 0, <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>In this example, we sent <code>?file=/etc/passwd</code> as a GET payload. The CRS should catch the string <code>/etc/passwd</code> which is on our blocklist. Try out the command in a terminal now if you like!</p><p>You can send anything you want at the sandbox, for instance, you can send HTTP headers, POST data, use various HTTP methods, et cetera.</p><p>The sandbox will return a 200 response code, no matter if an attack was detected or not.</p><p>The sandbox also adds a <code>X-Unique-Id</code> header to the response. It contains a unique value that you can use to refer to your request when communicating with us. With <code>curl -i</code> you can see the returned headers.</p><h3 id=example-showing-the-response-headers>Example showing the response headers</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -i -H <span style=color:#e6db74>&#39;x-format-output: txt-matched-rules&#39;</span> <span style=color:#e6db74>&#39;https://sandbox.coreruleset.org/?test=posix_uname()&#39;</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Date: Tue, <span style=color:#ae81ff>25</span> Jan <span style=color:#ae81ff>2022</span> 13:53:07 GMT
</span></span><span style=display:flex><span>Content-Type: text/plain
</span></span><span style=display:flex><span>Transfer-Encoding: chunked
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>X-Unique-ID: YfAAw3Gq8uf24wZCMjHTcAAAANE
</span></span><span style=display:flex><span>x-backend: apache-3.3.2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>933150</span> PL1 PHP Injection Attack: High-Risk PHP Function Name Found
</span></span><span style=display:flex><span><span style=color:#ae81ff>949110</span> PL1 Inbound Anomaly Score Exceeded <span style=color:#f92672>(</span>Total Score: 5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>980130</span> PL1 Inbound Anomaly Score Exceeded <span style=color:#f92672>(</span>Total Inbound Score: <span style=color:#ae81ff>5</span> - SQLI<span style=color:#f92672>=</span>0,XSS<span style=color:#f92672>=</span>0,RFI<span style=color:#f92672>=</span>0,LFI<span style=color:#f92672>=</span>0,RCE<span style=color:#f92672>=</span>0,PHPI<span style=color:#f92672>=</span>5,HTTP<span style=color:#f92672>=</span>0,SESS<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>: individual paranoia level scores: 5, 0, 0, <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h2 id=default-options>Default options</h2><p>It’s useful to know that you can tweak the sandbox in various ways. If you don’t send any <code>X-</code> headers, the sandbox will use the following defaults.</p><ul><li>The default backend is <em>Apache 2 with ModSecurity 2.9</em>.</li><li>The default CRS version is the <em>latest release version</em>, currently 3.3.2.</li><li>The default Paranoia Level is 1, which is the least strict setting.</li><li>By default, the response is the full audit log from the WAF, which is verbose and includes unnecessary information, hence why <code>X-Format-Output: txt-matched-rules</code> is useful.</li></ul><h2 id=changing-options>Changing options</h2><p>Let’s say you want to try your payload on different WAF engines or CRS versions, or like the output in a different format for automated usage. You can do this by adding the following HTTP headers to your request:</p><ul><li><code>x-crs-version</code>: will pick another CRS version. Available values are <code>3.3.2</code> (default), <code>3.2.1</code>, <code>nightly</code> (which has the latest changes which are not released) and <code>3.4.0-dev-log4j</code> (which contains an experimental rule against Log4j attacks).</li><li><code>x-crs-paranoia-level</code>: will run CRS in a given paranoia level. Available values are <code>1</code> (default), <code>2</code>, <code>3</code>, <code>4</code>.</li><li><code>x-crs-mode</code>: can be changed to return the http status code from the backend WAF. Default value is blocking (<code>On</code>), and can be changed using <code>detection</code> (will set engine to <code>DetectionOnly</code>). Values are case insensitive.</li><li><code>x-crs-inbound-anomaly-score-threshold</code>: defines the inbound anomaly score threshold. Valid values are any integer > 0, with <code>5</code> being the CRS default. ⚠️ Anything different than a positive integer will be taken as 0, so it will be ignored. This only makes sense if <code>blocking</code> mode is enabled (the default now).</li><li><code>x-crs-outbound-anomaly-score-threshold</code>: defines the outbound anomaly score threshold. Valid values are any integer > 0, with <code>4</code> being the CRS default. ⚠️ Anything different than a positive integer will be taken as 0, so it will be ignored. This only makes sense if <code>blocking</code> mode is enabled (the default now).</li><li><code>x-backend</code> allows you to select the specific backend web server<ul><li><code>apache</code> (default) will send the request to <strong>Apache 2 + ModSecurity 2.9</strong>.</li><li><code>nginx</code> will send the request to <strong>Nginx + ModSecurity 3</strong>.</li><li><code>coraza-caddy</code> will send the request to <strong>Caddy + Coraza WAF</strong>.</li></ul></li><li><code>x-format-output</code> formats the response to your use-case (human or automation). Available values are:<ul><li>omitted/default: the WAF’s audit log is returned unmodified as JSON</li><li><code>txt-matched-rules</code>: human-readable list of CRS rule matches, one rule per line</li><li><code>txt-matched-rules-extended</code>: same but with explanation for easy inclusion in publications</li><li><code>json-matched-rules</code>: JSON formatted CRS rule matches</li><li><code>csv-matched-rules</code>: CSV formatted</li></ul></li></ul><p>The header names are case-insensitive.</p><p>Tip: if you work with JSON output (either unmodified or matched rules), <code>jq</code> is a useful tool to work with the output, for example you can add <code>| jq .</code> to get a pretty-printed JSON, or use <code>jq</code> to filter and modify the output.</p><h3 id=advanced-examples>Advanced examples</h3><p>Let’s say you want to send a payload to an old CRS version <strong>3.2.1</strong> and choose <strong>Nginx + ModSecurity 3</strong> as a backend, because this is what you are interested in. You want to get the output in JSON because you want to process the results with a script. (For now, we use <code>jq</code> to pretty-print it.)</p><p>The command would look like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -H <span style=color:#e6db74>&#34;x-backend: nginx&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;x-crs-version: 3.2.1&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;x-format-output: json-matched-rules&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  https://sandbox.coreruleset.org/?file<span style=color:#f92672>=</span>/etc/passwd | jq .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;OS File Access Attempt&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;930120&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;paranoia_level&#34;</span>: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;Remote Command Execution: Unix Shell Code Found&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;932160&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;paranoia_level&#34;</span>: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;Inbound Anomaly Score Exceeded (Total Score: 10)&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;949110&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;paranoia_level&#34;</span>: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Let’s say you are working on a vulnerability publication and want to add a paragraph to explain how CRS protects (or doesn’t!) against your exploit. Then the <code>txt-matched-rules-extended</code> can be a useful format for you.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -H <span style=color:#e6db74>&#39;x-format-output: txt-matched-rules-extended&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  https://sandbox.coreruleset.org/?file<span style=color:#f92672>=</span>/etc/passwd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>This payload has been tested against the OWASP ModSecurity Core Rule Set
</span></span><span style=display:flex><span>web application firewall. The test was executed using the apache engine and CRS version 3.3.2.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The payload is being detected by triggering the following rules:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>930120</span> PL1 OS File Access Attempt
</span></span><span style=display:flex><span><span style=color:#ae81ff>932160</span> PL1 Remote Command Execution: Unix Shell Code Found
</span></span><span style=display:flex><span><span style=color:#ae81ff>949110</span> PL1 Inbound Anomaly Score Exceeded <span style=color:#f92672>(</span>Total Score: 10<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>980130</span> PL1 Inbound Anomaly Score Exceeded <span style=color:#f92672>(</span>Total Inbound Score: <span style=color:#ae81ff>10</span> - SQLI<span style=color:#f92672>=</span>0,XSS<span style=color:#f92672>=</span>0,RFI<span style=color:#f92672>=</span>0,LFI<span style=color:#f92672>=</span>5,RCE<span style=color:#f92672>=</span>5,PHPI<span style=color:#f92672>=</span>0,HTTP<span style=color:#f92672>=</span>0,SESS<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>: individual paranoia level scores: 10, 0, 0, <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CRS therefore detects this payload starting with paranoia level 1.
</span></span></code></pre></div><h2 id=capacity>Capacity</h2><ul><li>Please do not send more than 10 requests per second.</li><li>We will try to scale in response to demand.</li></ul><h2 id=architecture>Architecture</h2><p>The sandbox consists of various parts. The frontend that receives the requests runs on Openresty. It handles the incoming request, chooses and configures the backend running CRS, proxies the request to the backend, and waits for the response. Then it parses the WAF audit log and sends the matched rules back in the format chosen by the user.</p><p><img src=https://coreruleset.org/assets/uploads/2022/01/CRS_sandbox_diagram_v3.drawio.png alt="CRS sandbox diagram v3.drawio.png"></p><p>There is a backend container for every engine and version. For instance, one Apache with CRS 3.2.2, one with CRS 3.2.1, et cetera&mldr; These are normal webserver installations with a WAF and the CRS.</p><p>The backend writes their JSON logs to a volume to be read by a collector script and sent to S3 bucket and Elasticsearch.</p><p>The logs are parsed, and values like User-Agent and geolocation are extracted. We use Kibana to keep an overview of how the sandbox is used, and hopefully gain new insights about attacks.</p><h2 id=known-issues>Known issues</h2><p>In some cases, the sandbox will not properly handle and finish your request.</p><ul><li><strong>Malformed HTTP requests:</strong> The frontend, Openresty, is itself a HTTP server which performs parsing of the incoming request. The backend servers running CRS are regular webservers such as Apache and Nginx. Either one of these may reject a malformed HTTP request with an error 400 before it is even processed by CRS. This happens for instance when you try to send an Apache 2.4.50 attack that depended on a URL encoding violation. If you receive an error 400, your request was rejected by the frontend or a backend, and it was not scanned by CRS.</li><li><strong>ReDoS:</strong> If your request leads to a ReDoS and makes the backend spend too much time to process a regular expression, this leads to a timeout from the backend server. The frontend will cancel the request with an error 502. If you have to wait a long time and then receive an error 502, there was likely a ReDoS situation.</li></ul><h2 id=questions-and-suggestions>Questions and suggestions</h2><p>If you have any issues with the CRS sandbox, please open a GitHub issue at <a href=https://github.com/coreruleset/coreruleset/issues>https://github.com/coreruleset/coreruleset/issues</a> and we will help you as soon as possible.</p><p>If you have suggestions for extra functionality, a GitHub issue is appreciated.</p><h2 id=working-on-the-sandbox-adding-new-backends>Working on the sandbox: adding new backends</h2><p>The following notes are handy for our team maintaining the sandbox.</p><p>To add a new backend:</p><ul><li>Each backend has its own IP address.</li><li>docker-compose: copy-paste a back-end container. Give it a new unused IP address in the 10.5.0.* virtual network.</li><li>The frontend needs to know how to reach the desired backend. There is a hardcoded list in openresty/conf/access.lua with the target IP address.</li><li>httpd-vhosts.conf needs to be changed.</li></ul><footer class=footline></footer></main></div><div id=navigation><a class="nav nav-prev" href=/documentation/development/plugin_writing/ title="Writing Plugins"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/documentation/resources/ title="Additional Resources"><i class="fa fa-chevron-right"></i></a></div></div><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/documentation/js/clipboard.min.js?1685100206></script>
<script src=/documentation/js/perfect-scrollbar.min.js?1685100206></script>
<script src=/documentation/js/perfect-scrollbar.jquery.min.js?1685100206></script>
<script src=/documentation/js/jquery.svg.pan.zoom.js?1685100206></script>
<script src=/documentation/js/featherlight.min.js?1685100206></script>
<script src=/documentation/js/modernizr.custom-3.6.0.js?1685100206></script>
<script src=/documentation/js/mermaid.min.js?1685100206></script>
<script>typeof mermaid!="undefined"&&mermaid.mermaidAPI.initialize(Object.assign({securityLevel:"antiscript"},JSON.parse('{ "startOnLoad": true }'),{startOnLoad:!1}))</script><script src=/documentation/js/relearn.js?1685100206></script>
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://piwik.netnea.com/matomo/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","4"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script><img referrerpolicy=no-referrer-when-downgrade src="https://piwik.netnea.com/matomo/matomo.php?idsite=4&rec=1" style=border:0 alt></body></html>