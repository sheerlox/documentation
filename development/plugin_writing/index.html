<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.97.3"><meta name=description content="CoreRuleSet Documentation"><meta name=author content="CoreRuleSet"><link rel=icon href=/documentation/images/favicon.png type=image/png><title>Writing Plugins :: Core Rule Set Documentation</title><link href=/documentation/css/nucleus.css?1685100206 rel=stylesheet><link href=/documentation/css/fontawesome-all.min.css?1685100206 rel=stylesheet><link href=/documentation/css/featherlight.min.css?1685100206 rel=stylesheet><link href=/documentation/css/perfect-scrollbar.min.css?1685100206 rel=stylesheet><link href=/documentation/css/auto-complete.css?1685100206 rel=stylesheet><link href=/documentation/css/theme.css?1685100206 rel=stylesheet><link href=/documentation/css/theme-blue.css?1685100206 rel=stylesheet><link href=/documentation/css/variant.css?1685100206 rel=stylesheet><link href=/documentation/css/print.css?1685100206 rel=stylesheet media=print><script src=/documentation/js/jquery.min.js?1685100206></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/documentation/development/plugin_writing/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://coreruleset.github.io/documentation/><img src=https://coreruleset.github.io/documentation//images/logo.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script src=/documentation/js/lunr.min.js?1685100206></script>
<script src=/documentation/js/auto-complete.js?1685100206></script>
<script>var index_url="/documentation/index.json",root_url="/",baseUri=root_url.replace(/\/$/,'')</script><script src=/documentation/js/search.js?1685100206></script></div><div id=homelinks><ul><li><a class=padding href=/documentation/><i class="fas fa-home"></i> Home</a></li></ul></div><div class=highlightable><ul class=topics><li data-nav-id=/documentation/deployment/ title="Getting CRS" class=dd-item><a href=/documentation/deployment/><b>1. </b>Getting CRS<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/deployment/engine_integration_options/ title="Engine and Integration Options" class=dd-item><a href=/documentation/deployment/engine_integration_options/>Engine and Integration Options<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/deployment/quick_start/ title="Quick Start Guide" class=dd-item><a href=/documentation/deployment/quick_start/>Quick Start Guide<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/deployment/install/ title="Extended Install" class=dd-item><a href=/documentation/deployment/install/>Extended Install<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/concepts/ title="How CRS Works" class=dd-item><a href=/documentation/concepts/><b>2. </b>How CRS Works<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/concepts/anomaly_scoring/ title="Anomaly Scoring" class=dd-item><a href=/documentation/concepts/anomaly_scoring/>Anomaly Scoring<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/paranoia_levels/ title="Paranoia Levels" class=dd-item><a href=/documentation/concepts/paranoia_levels/>Paranoia Levels<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/false_positives_tuning/ title="False Positives and Tuning" class=dd-item><a href=/documentation/concepts/false_positives_tuning/>False Positives and Tuning<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/plugins/ title="Plugin Mechanism" class=dd-item><a href=/documentation/concepts/plugins/>Plugin Mechanism<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/concepts/sampling_mode/ title="Sampling Mode" class=dd-item><a href=/documentation/concepts/sampling_mode/>Sampling Mode<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/operation/ title=Operation class=dd-item><a href=/documentation/operation/><b>3. </b>Operation<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/operation/known_issues/ title="Known Issues" class=dd-item><a href=/documentation/operation/known_issues/>Known Issues<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/operation/containers/ title="Using Containers" class=dd-item><a href=/documentation/operation/containers/>Using Containers<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/operation/kubernetes_ingress/ title="Kubernetes Ingress Controllers" class=dd-item><a href=/documentation/operation/kubernetes_ingress/>Kubernetes Ingress Controllers<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/operation/log_handling/ title="Log Handling" class=dd-item><a href=/documentation/operation/log_handling/>Log Handling<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/rules/ title=Rules class=dd-item><a href=/documentation/rules/><b>4. </b>Rules<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/rules/ruleid/ title="Rule IDs" class=dd-item><a href=/documentation/rules/ruleid/>Rule IDs<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/rules/ title=Rules class=dd-item><a href=/documentation/rules/rules/>Rules<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/creating/ title=Making class=dd-item><a href=/documentation/rules/creating/>Making<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/metadata/ title=Metadata class=dd-item><a href=/documentation/rules/metadata/>Metadata<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/development/ title=Development class="dd-item parent"><a href=/documentation/development/><b>5. </b>Development<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/development/contribution_guidelines/ title="Contribution Guidelines" class=dd-item><a href=/documentation/development/contribution_guidelines/>Contribution Guidelines<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/crs_toolchain/ title=crs-toolchain class=dd-item><a href=/documentation/development/crs_toolchain/>crs-toolchain<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/regex_assembly/ title="Assembling Regular Expressions" class=dd-item><a href=/documentation/development/regex_assembly/>Assembling Regular Expressions<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/rule_writing/ title="Writing Rules" class=dd-item><a href=/documentation/development/rule_writing/>Writing Rules<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/useful_tools/ title="Useful Tools" class=dd-item><a href=/documentation/development/useful_tools/>Useful Tools<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/testing/ title="Testing the Rule Set" class=dd-item><a href=/documentation/development/testing/>Testing the Rule Set<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/plugin_writing/ title="Writing Plugins" class="dd-item active"><a href=/documentation/development/plugin_writing/>Writing Plugins<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/sandbox/ title="Using the CRS Sandbox" class=dd-item><a href=/documentation/development/sandbox/>Using the CRS Sandbox<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/resources/ title="Additional Resources" class=dd-item><a href=/documentation/resources/><b>6. </b>Additional Resources<i class="fas fa-check read-icon"></i></a><ul></ul></li><li data-nav-id=/documentation/miscellaneous/ title=Miscellaneous class=dd-item><a href=/documentation/miscellaneous/><b>7. </b>Miscellaneous<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/miscellaneous/self_contained_mode/ title="Self-Contained Mode" class=dd-item><a href=/documentation/miscellaneous/self_contained_mode/>Self-Contained Mode<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><div id=shortcuts><div class=nav-title>More</div><ul><li><a class=padding href=https://coreruleset.org/><i class="fas fa-bookmark"></i> Core Rule Set Home</a></li><li><a class=padding href=https://github.com/coreruleset/coreruleset><i class="fab fa-github"></i> Core Rule Set GitHub</a></li></ul></div><div id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></div><div id=footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></nav><div id=body><div id=overlay></div><div class="padding highlightable"><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/coreruleset/documentation/blob/main/content/development/plugin_writing.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>Writing Plugins</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#how-to-write-a-plugin>How to Write a Plugin</a><ul><li><a href=#is-a-plugin-the-right-approach-for-a-given-rule-problem>Is a Plugin the Right Approach for a Given Rule Problem?</a></li><li><a href=#plugin-writing-guidance>Plugin Writing Guidance</a></li><li><a href=#anomaly-scoring-getting-the-phases-right>Anomaly Scoring: Getting the Phases Right</a></li></ul></li><li><a href=#quality-guarantee>Quality Guarantee</a></li><li><a href=#how-to-integrate-a-plugin-into-the-official-registry>How to Integrate a Plugin into the Official Registry</a></li></ul></nav></div></div></div><div id=head-tags></div><main id=body-inner><h1>Writing Plugins</h1><blockquote><p>The CRS plugin mechanism allows the rule set to be extended in specific, experimental, or unusual ways. This page explains how to write a new plugin to extend CRS.</p></blockquote><h2 id=how-to-write-a-plugin>How to Write a Plugin</h2><h3 id=is-a-plugin-the-right-approach-for-a-given-rule-problem>Is a Plugin the Right Approach for a Given Rule Problem?</h3><p>This is the first and most important question to ask.</p><p>CRS is a generic rule set. The rule set has no awareness of the particular setup it finds itself deployed in. As such, the rules are written with caution and administrators are given the ability to steer the behavior of CRS by setting the anomaly threshold accordingly. <em>An administrator writing their own rules knows a lot more about their specific setup</em>, so there&rsquo;s probably no need to be as cautious. It&rsquo;s also probably futile to write anomaly scoring rules in this situation. Anomaly scoring adds little value if an administrator knows that everybody issuing a request to <code>/no-access</code>, for example, is an attacker.</p><p>In such a situation, it&rsquo;s better to write a simple deny-rule that blocks said requests. There&rsquo;s no need for a plugin in most situations.</p><h3 id=plugin-writing-guidance>Plugin Writing Guidance</h3><p>When there really <em>is</em> a good use case for a plugin, it&rsquo;s recommended to start with a clone of the <a href=https://github.com/coreruleset/template-plugin>template plugin</a>. It&rsquo;s well documented and a good place to start from.</p><p>Plugins are a new idea for CRS. As such, there aren&rsquo;t currently any strict rules about what a plugin is and isn&rsquo;t allowed to do. There are definitely fewer rules and restrictions for writing plugin rules than for writing a mainline CRS rule, which is becoming increasingly strict as the project evolves. This means that it&rsquo;s basically possible to do anything in a plugin, especially when there&rsquo;s no plan to contribute the plugin to the CRS project.</p><p>When it <em>is</em> planned to contribute a plugin back to the CRS project, the following guidance will help:</p><ul><li>Try to keep plugins separate. Try not to interfere with other plugins and make sure that any other plugin can run next to yours.</li><li>Be careful when interfering with CRS. It&rsquo;s easy to disrupt CRS by excluding essential rules or by messing with variables.</li><li>Keep an eye on performance and think of use cases.</li></ul><h3 id=anomaly-scoring-getting-the-phases-right>Anomaly Scoring: Getting the Phases Right</h3><p>The anomaly scores are only initialized in the CRS rules file <code>REQUEST-901-INITIALIZATION.conf</code>. This happens in phase 1, but it still happens <em>after</em> a plugin&rsquo;s <code>*-before.conf</code> file has been executed for phase 1. As a consequence, if anomaly scores are set there then they&rsquo;ll be overwritten in CRS phase 1.</p><p>The effect for phase 2 anomaly scoring in a plugin&rsquo;s <code>*-after.conf</code> file is similar. It happens after the CRS request blocking happens in phase 2. This can mean a plugin raises the anomaly score <em>after</em> the blocking decision. This might result in a higher anomaly score in the log file and confusion as to why the request was not blocked.</p><p>What to do is as follows:</p><ul><li><strong>Scoring in phase 1:</strong> Put in the plugin&rsquo;s <em>After-File</em> (and be aware that early blocking won&rsquo;t work).</li><li><strong>Scoring in phase 2:</strong> Put in the plugin&rsquo;s <em>Before-File</em>.</li></ul><h2 id=quality-guarantee>Quality Guarantee</h2><p>The official CRS plugins are separated from third party plugins. The rationale is to keep the quality of official plugins on par with the quality of the CRS project itself. It&rsquo;s not possible to guarantee the quality of third party plugins as their code is not under the control of the CRS project. Third party plugins should be examined and considered separately to decide whether their quality is sufficient for use in production.</p><h2 id=how-to-integrate-a-plugin-into-the-official-registry>How to Integrate a Plugin into the Official Registry</h2><p>Plugins should be developed and refined until they are production-ready. The next step is to open a pull request at the <a href=https://github.com/coreruleset/plugin-registry>plugin registry</a>. Any free rule ID range can be used for a new plugin. The plugin will then be reviewed and assigned a block of rule IDs. Afterwards, the plugin will be listed as a new third party plugin.</p><footer class=footline></footer></main></div><div id=navigation><a class="nav nav-prev" href=/documentation/development/testing/ title="Testing the Rule Set"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/documentation/development/sandbox/ title="Using the CRS Sandbox"><i class="fa fa-chevron-right"></i></a></div></div><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/documentation/js/clipboard.min.js?1685100206></script>
<script src=/documentation/js/perfect-scrollbar.min.js?1685100206></script>
<script src=/documentation/js/perfect-scrollbar.jquery.min.js?1685100206></script>
<script src=/documentation/js/jquery.svg.pan.zoom.js?1685100206></script>
<script src=/documentation/js/featherlight.min.js?1685100206></script>
<script src=/documentation/js/modernizr.custom-3.6.0.js?1685100206></script>
<script src=/documentation/js/mermaid.min.js?1685100206></script>
<script>typeof mermaid!="undefined"&&mermaid.mermaidAPI.initialize(Object.assign({securityLevel:"antiscript"},JSON.parse('{ "startOnLoad": true }'),{startOnLoad:!1}))</script><script src=/documentation/js/relearn.js?1685100206></script>
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://piwik.netnea.com/matomo/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","4"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script><img referrerpolicy=no-referrer-when-downgrade src="https://piwik.netnea.com/matomo/matomo.php?idsite=4&rec=1" style=border:0 alt></body></html>