<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.97.3"><meta name=generator content="Relearn 3.4.1+tip"><meta name=description content="CoreRuleSet Documentation"><meta name=author content="CoreRuleSet"><title>Installing CoreRuleSet :: Core Rule Set Documentation</title><link rel=icon href=/documentation/images/favicon.png?1650832653 type=image/png><link href=/documentation/css/nucleus.css?1650832653 rel=stylesheet><link href=/documentation/css/fontawesome-all.min.css?1650832653 rel=stylesheet><link href=/documentation/css/featherlight.min.css?1650832653 rel=stylesheet><link href=/documentation/css/perfect-scrollbar.min.css?1650832653 rel=stylesheet><link href=/documentation/css/auto-complete.css?1650832653 rel=stylesheet><link href=/documentation/css/theme.css?1650832653 rel=stylesheet><link href=/documentation/css/theme-blue.css?1650832653 rel=stylesheet id=variant-style><link href=/documentation/css/variant.css?1650832653 rel=stylesheet><link href=/documentation/css/print.css?1650832653 rel=stylesheet media=print><script src=/documentation/js/variant.js?1650832653></script>
<script>var index_url="/documentation/index.json",baseUriFull,root_url="/",baseUri=root_url.replace(/\/$/,'');window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",baseUriFull="https://coreruleset.github.io/documentation/",variants.init(["blue"])</script><script src=/documentation/js/jquery.min.js?1650832653></script></head><body class=mobile-support data-url=/documentation/deployment/install/><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div class=navigation><a class="nav nav-next" href=/documentation/configuring/ title="How it Works"><i class="fas fa-chevron-right fa-fw"></i></a></div><div class=navigation><a class="nav nav-prev" href=/documentation/deployment/quickstart/ title="OWASP CRS Quickstart"><i class="fas fa-chevron-left fa-fw"></i></a></div><div id=top-github-link><a class=github-link title=Edit href=https://github.com/coreruleset/documentation/blob/main/content/deployment/install.md target=blank><i class="fas fa-pen fa-fw"></i></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle title=Menu><i class="fas fa-bars fa-fw"></i></a></span>
<span id=toc-menu title="Table of Contents"><i class="fas fa-list-alt fa-fw"></i></span>
<span class=links>Installing CoreRuleSet</span></div><div class="default-animation progress"><div class=wrapper><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#finding-where-to-edit-in-your-configuration>Finding where to edit in your configuration</a><ul><li><a href=#apache-2x-with-modsecurity-2x-compiled>Apache 2.x with ModSecurity 2.x Compiled</a></li><li><a href=#apache-2x-with-modsecurity-2x-packaged-rhel>Apache 2.x with ModSecurity 2.x Packaged (RHEL)</a></li><li><a href=#nginx-with-modsecurity-2x-compiled>Nginx with ModSecurity 2.x Compiled</a></li><li><a href=#nginx-with-modsecurity-3x-libmodsecurity-compiled>Nginx with ModSecurity 3.x (libmodsecurity) Compiled</a></li><li><a href=#microsoft-iis-with-modsecurity-2x>Microsoft IIS with ModSecurity 2.x</a></li></ul></li><li><a href=#downloading-owasp-crs>Downloading OWASP CRS</a><ul><li><a href=#setting-up-owasp-crs>Setting up OWASP CRS</a></li></ul></li><li><a href=#proceeding-with-the-installation>Proceeding with the Installation</a><ul><li><a href=#includes-for-apache>Includes for Apache</a></li><li><a href=#includes-for-nginx>Includes for Nginx</a></li></ul></li><li><a href=#setting-up-automated-updates>Setting up automated updates</a><ul><li><a href=#an-update-script>An update script</a></li></ul></li><li><a href=#problems-with-installation>Problems with installation</a><ul><li><a href=#apache-line-continuation>Apache Line Continuation</a></li><li><a href=#anomaly-mode-doesnt-work>Anomaly Mode Doesn&rsquo;t Work</a></li><li><a href=#webserver-returns-error-after-crs-install>Webserver returns error after CRS install</a></li></ul></li></ul></nav></div></div></div></nav><main id=body-inner class=highlightable><div class=flex-block-wrapper><div id=head-tags></div><article><h1>Installing CoreRuleSet</h1><div class="box notices note"><div class=box-label><i class="fas fa-exclamation-circle fa-fw"></i> Note</div><div class=box-content><p><strong>The content on this page may be outdated.</strong> We are currently in the process of rewriting all of our documentation: please bear with us while we update our older content.</p></div></div><p>If you need mode information than the one in the <a href=https://coreruleset.github.io/documentation/deployment/quickstart/>quickstart guide</a>, here we extend with additional details so keep reading.</p><p>Below you should find all the information you need to properly install
CRS. If you are having problems feel free to reach out to our <a href=https://groups.google.com/a/owasp.org/forum/#!forum/modsecurity-core-rule-set-project>Google Group</a>, or our <a href=https://owasp.slack.com/archives/CBKGH8A5P>Slack Channel</a>. If you don&rsquo;t have access yet, <a href=https://owasp.org/slack/invite>get your invite here</a>.</p><h2 id=prerequisites>Prerequisites</h2><p>Installing the CRS isn&rsquo;t very hard but it does have one major requirement, ModSecurity. If ModSecurity isn&rsquo;t working properly you will likely run into problems running the CRS.</p><div class="box notices warning"><div class=box-label><i class="fas fa-exclamation-triangle fa-fw"></i> Warning</div><div class=box-content><p>In order to run the CRS <code>3.x</code> branch you require AT MINIMUM ModSecurity 2.8 or above, preferably version <code>3.x</code> or above.</p></div></div><h2 id=finding-where-to-edit-in-your-configuration>Finding where to edit in your configuration</h2><p>ModSecurity comes in MANY different version with support for a multitude
of Operating Systems (OS) and Web Servers. The installation locations
may differ greatly between these different options so please be aware
that the following are just some of the more common configurations.</p><h3 id=apache-2x-with-modsecurity-2x-compiled>Apache 2.x with ModSecurity 2.x Compiled</h3><p>Compiling ModSecurity is easy, but slightly outside the scope of this
document. If you are interested in learning how to compile ModSecurity
please go to the ModSecurity documentation. Having compiled ModSecurity
there is a simple test to see if your installation is working. If you
have compiled from source you would have needed to include <code>LoadModule security2_module modules/mod_security2.so</code> either in <code>httpd.conf</code> (<code>apache2.conf</code> on Debian) or in some file included from this file.
Anywhere after you load your module you may add the following
ModSecurity directives.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=display:flex><span>SecRuleEngine <span style=color:#66d9ef>On</span>
</span></span><span style=display:flex><span>SecRule ARGS:testparam <span style=color:#e6db74>&#34;@contains test&#34;</span> <span style=color:#e6db74>&#34;id:1234,deny,status:403,msg:&#39;Our test rule has triggered&#39;&#34;</span>
</span></span></code></pre></div><p>If you restart Apache you may now navigate to any page on your web
server passing the parameter <code>'testparam'</code> with the value <code>'test'</code> (via
post or get) and you should receive a 403. This request will typically
appear similar to as follows: <code>http://localhost/?testparam=test</code>.</p><p>If you obtained a 403 status code your ModSecurity instance is
functioning correctly with Apache and you now know where to place
directives.</p><h3 id=apache-2x-with-modsecurity-2x-packaged-rhel>Apache 2.x with ModSecurity 2.x Packaged (RHEL)</h3><p>Many operating systems provide package managers in order to aid in the
install of software packages and their associated dependencies. Even
though ModSecurity is relatively straight forward to install, some
people prefer using package managers due to their ease. It should be
noted here that many package managers do not up date their releases very
frequently, as a result it is quite likely that your distribution may be
missing required features or possibly even have security
vulnerabilities. Additionally, depending on your package/package manager
your ModSecurity configuration will be laid out slightly different.</p><p>On Fedora we will find that when you use <code>dnf install mod_security</code>
you will receive the base ModSecurity package. Apache&rsquo;s configuration
files are split out within this environment such that there are
different folders for the base config (<code>/etc/httpd/config</code>), user
configuration (<code>/etc/httpd/conf.d</code>, and module configuration
(<code>/etc/httpd/conf.modules.d/</code>). The Fedora ModSecurity 2.x package places
the LoadModule and associated &lsquo;Include&rsquo;s within
<code>/etc/httpd/conf.modules.d/10-mod_security.conf</code>. Additionally, it places
some of the reccomended default rules in
<code>/etc/httpd/conf.d/mod_security.conf</code>. It is this secondary configuration
file that will setup the locations where you should add your rules. By
default it reads in all config files from the <code>/etc/httpd/modsecurity.d/</code>
and <code>/etc/httpd/modsecurity.d/activated_rules/</code> folder. To keep order I
would reccomend testing this configuration by placing a <code>rules.conf</code> file
within the <code>activated_rules</code> folder. Within this <code>rules.conf</code> file add the
following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SecRuleEngine On
</span></span><span style=display:flex><span>SecRule ARGS:testparam <span style=color:#e6db74>&#34;@contains test&#34;</span> <span style=color:#e6db74>&#34;id:1234,deny,status:403,msg:&#39;Our test rule has triggered&#39;&#34;</span>
</span></span></code></pre></div><p>Upon saving and restarting Apache (<code>systemctl restart httpd.service</code>) you
should be able to navigate to a your local webserver. Once this is
accomplished try passing the &rsquo;testparam&rsquo; paramater with the value
&rsquo;test&rsquo; such as via the following
URL: <code>http://localhost/?testparam=test</code>. You should receive a 403
Forbidden status. If you do congratulations, ModSecurity is ready for
the OWASP CRS rules.</p><h3 id=nginx-with-modsecurity-2x-compiled>Nginx with ModSecurity 2.x Compiled</h3><p>ModSecurity 2.x currently doesn&rsquo;t support the new Nginx loadable
modules. As a result, it is required that you compile Nginx from source
with ModSecurity. For more information on how to do this see the
ModSecurity documentaiton. Once ModSecurity is compiled in you will have
to specify both &lsquo;ModSecurityEnabled&rsquo; and &lsquo;ModSecurityConfig&rsquo; within
any location block where you want ModSecurity enabled. An example would
look similar to below.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>ModSecurityEnabled</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ModSecurityConfig</span> <span style=color:#e6db74>modsec_includes.conf</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Within this <code>modsec_includes.conf</code> you may use the <code>Include</code> directive to
include other files or any ModSecurity directives. For our testing
purpose we will add the following to our <code>modsec_includes.conf</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Apache data-lang=Apache><span style=display:flex><span>SecRuleEngine <span style=color:#66d9ef>On</span>
</span></span><span style=display:flex><span>SecRule ARGS:testparam <span style=color:#e6db74>&#34;@contains test&#34;</span> <span style=color:#e6db74>&#34;id:1234,deny,status:403,msg:&#39;Our test rule has triggered&#39;&#34;</span>
</span></span></code></pre></div><p>Upon saving and restarting Nginx (<code>./nginx -s reload</code>) you should be able
to navigate to a your local webserver. Once this is accomplished try
passing the &rsquo;testparam&rsquo; paramater with the value &rsquo;test&rsquo; such as via
the following URL: <code>http://localhost/?testparam=test</code>. You should receive
a 403 Forbidden status. If you do congratulations, ModSecurity is ready
for the OWASP CRS rules üöÄ.</p><h3 id=nginx-with-modsecurity-3x-libmodsecurity-compiled>Nginx with ModSecurity 3.x (libmodsecurity) Compiled</h3><h3 id=microsoft-iis-with-modsecurity-2x>Microsoft IIS with ModSecurity 2.x</h3><p>The most common deployment of ModSecurity for IIS is via the
pre-packaged MSI installer, available at <a href=https://www.modsecurity.org/download.html>https://www.modsecurity.org/download.html</a>. If you compiled or are looking to compile ModSecurity for IIS this documentation isn&rsquo;t for
you.</p><p>If you used this package to install ModSecurity 2.x on IIS (tested
on IIS 7-10), than your configuration files are located within<code>C:\Program Files\ModSecurity IIS\</code> (or Program Files(x86) depending on your configuration). The inital configuration file, that is the one that the remainder are included from, is <code>modsecurity_iis.conf</code>. This file will be parsed by the ModSecurity for both ModSecurity and <code>'Include'</code> directives.</p><p>By default all installations of ModSecurity without <a href=https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual-(v2.x)#SecRuleEngine>SecRuleEngine</a> declared will start in DetectionOnly mode. IIS, by default, explicitly declares <a href=https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual-(v2.x)#SecRuleEngine>SecRuleEngine</a> to be DetectionOnly within the included modsecurity.conf file. As a result any rule we make will only show up in the Windows Event Viewer by default. For our example we&rsquo;re going to turn on disruptive actions. To test we should add the following to the end of our <code>modsecurity_iis.conf</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=display:flex><span>SecRuleEngine <span style=color:#66d9ef>On</span>
</span></span><span style=display:flex><span>SecRule ARGS:testparam <span style=color:#e6db74>&#34;@contains test&#34;</span> <span style=color:#e6db74>&#34;id:1234,deny,status:403,msg:&#39;Our test rule has triggered&#39;&#34;</span>
</span></span></code></pre></div><p>This rule will be triggered when you go to your web page and pass the testparam (via either GET or POST) with the test value. This typically will looks similar to the following: <code>http://localhost/?testparam=test</code>.</p><p>If all went well you should see an HTTP 403 Forbidden in your browser when you navigate to the site in question. Additionally, in your Event Viewer, under &lsquo;Windows Logs&rsquo;->&lsquo;Application&rsquo;, we should see a new log that looks like the following:</p><p>&lt;Log.png></p><p>If you have gotten to this step ModSecurity is functioning on IIS and you now know where to place new directives.</p><h2 id=downloading-owasp-crs>Downloading OWASP CRS</h2><p>Now that you know where your rules belong typically we&rsquo;ll want to download the OWASP CRS. The best place to get the latest copy of the ruleset will be from <a href=https://github.com/coreruleset/coreruleset/releases>our Github Releases</a>. There we have all our official releases listed. For production we recommend you to use the <strong>latest release</strong>, v3.3.2. If you want to test the bleeding edge version, we also provide <em>nightly releases</em>.</p><div class="box notices note"><div class=box-label><i class="fas fa-exclamation-circle fa-fw"></i> Note</div><div class=box-content><p>Releases are signed using <a href=https://coreruleset.org/security.asc>our GPG key</a>, (fingerprint: 3600 6F0E 0BA1 6783 2158 8211 38EE ACA1 AB8A 6E72). You can verify the release using GPG/PGP compatible tooling.</p><p>To get our key using gpg: <code>gpg --keyserver pgp.mit.edu --recv 0x38EEACA1AB8A6E72</code> (this id should be equal to the last sixteen hex characters in our fingerprint).
You can also use <code>gpg --fetch-key https://coreruleset.org/security.asc</code> directly.</p></div></div><p>The steps here assume you are using a *nix operating system. For Windows you will be doing a similar install, but probably using the zip file from our releases.</p><p>To get the release file and the corresponding signature:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://github.com/coreruleset/coreruleset/archive/refs/tags/v3.3.2.tar.gz
</span></span><span style=display:flex><span>wget https://github.com/coreruleset/coreruleset/releases/download/v3.3.2/coreruleset-3.3.2.tar.gz.asc
</span></span></code></pre></div><p>Optional verification:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --verify coreruleset-3.3.2.tar.gz.asc v3.3.2.tar.gz
</span></span><span style=display:flex><span>gpg: Signature made Wed Jun <span style=color:#ae81ff>30</span> 10:05:48 <span style=color:#ae81ff>2021</span> -03
</span></span><span style=display:flex><span>gpg:                using RSA key 36006F0E0BA167832158821138EEACA1AB8A6E72
</span></span><span style=display:flex><span>gpg: Good signature from <span style=color:#e6db74>&#34;OWASP Core Rule Set &lt;security@coreruleset.org&gt;&#34;</span> <span style=color:#f92672>[</span>unknown<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>gpg: WARNING: This key is not certified with a trusted signature!
</span></span><span style=display:flex><span>gpg:          There is no indication that the signature belongs to the owner.
</span></span><span style=display:flex><span>Primary key fingerprint: <span style=color:#ae81ff>3600</span> 6F0E 0BA1 <span style=color:#ae81ff>6783</span> <span style=color:#ae81ff>2158</span>  <span style=color:#ae81ff>8211</span> 38EE ACA1 AB8A 6E72
</span></span></code></pre></div><p>If the signature was good, the verification succeeded. If you see a warning like the above, it means you know our public key, but you are not trusting it. You can trust it by using the following method:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg edit-key 36006F0E0BA167832158821138EEACA1AB8A6E72
</span></span><span style=display:flex><span>gpg&gt; trust
</span></span><span style=display:flex><span>Your decision: <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>ultimate trust<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Are you sure: Yes
</span></span><span style=display:flex><span>gpg&gt; quit
</span></span></code></pre></div><p>Then you will see this result when verifying:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg --verify coreruleset-3.3.2.tar.gz.asc v3.3.2.tar.gz
</span></span><span style=display:flex><span>gpg: Signature made Wed Jun <span style=color:#ae81ff>30</span> 15:05:48 <span style=color:#ae81ff>2021</span> CEST
</span></span><span style=display:flex><span>gpg:                using RSA key 36006F0E0BA167832158821138EEACA1AB8A6E72
</span></span><span style=display:flex><span>gpg: Good signature from <span style=color:#e6db74>&#34;OWASP Core Rule Set &lt;security@coreruleset.org&gt;&#34;</span> <span style=color:#f92672>[</span>ultimate<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Once you downloaded and verified the release, you are ready to continue with the setup.</p><h3 id=setting-up-owasp-crs>Setting up OWASP CRS</h3><p>OWASP CRS contains one setup file that should be reviewed prior to
completing setup. The setup file is the only configuration file within
the root &lsquo;coreruleset-3.3.2&rsquo; folder and is named
<code>csr-setup.conf.example</code>. Going through this configuration file
and reading what the different options are is
HIGHLY recommended. At minimum you should keep in mind the following.</p><ul><li>CRS does not configure ModSecurity features such as the rule engine,
the audit engine, logging etc. This task is part of the ModSecurity
initial setup.If you haven&rsquo;t done this yet please check out the
<a href=https://github.com/SpiderLabs/ModSecurity/blob/master/modsecurity.conf-recommended>recommended ModSecurity configuration</a></li><li>By default <a href=https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual-%28v2.x%29#SecDefaultAction>SecDefaultAction</a> CRS will redirect to your local domain when an alert is triggered.
This may cause redirect loops depending on your configuration. Take
some time to decide what you want ModSecurity it do (drop the
packet, return a status:403, go to a custom page etc.) when it
detects malicious activity.</li><li>Make sure to configure your anomaly scoring thresholds for more
information see <a href=https://coreruleset.github.io/documentation/configuring/anomaly_scoring/ title=Anomaly>Anomaly</a></li><li>By default ModSecurity looks for lots of issues with different
databases and languages, if you are running a specific environment,
you probably want to limit this behavior for performance reasons.</li><li>ModSecurity supports <a href=https://www.projecthoneypot.org/>Project Honeypot</a> blacklists. This is a
great project and all you need to do to leverage it is sign up for
an <a href=https://www.projecthoneypot.org/httpbl_api.php>API key</a> (‚ö†Ô∏è it might be outdated)</li><li>Do make sure you have added any methods, static resources, content
types, or file extensions that your site needs beyond the basic ones
listed.</li></ul><p>For more information please see the page on
<a href=https://coreruleset.github.io/documentation/configuring/crs/ title=configuration>configuration</a>. Once you have reviewed
and configured CRS you should rename the file suffix from <code>.example</code> to
<code>.conf</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mv csr-setup.conf.example csr-setup.conf
</span></span></code></pre></div><p>In addition to <code>csr-setup.conf.example</code> there are two other .example files
within our repository. These files are:
<code>rules/REQUEST-00-LOCAL-WHITELIST.conf.example</code> and
<code>rules/RESPONSE-99-EXCEPTIONS.conf.example</code>. These files are designed to
provide the rule maintainer the capability to modify rules (see
<a href=https://coreruleset.github.io/documentation/configuring/false_positives_tuning/#rule-exclusions>false positives and tuning</a>) without breaking forward
compatability with updates. As such you should rename these two files,
removing the <code>.example</code> suffix. This will make it so that even when
updates are installed they do not overwrite your custom updates. To
rename the files in Linux one would use a command similar to the
following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mv rules/REQUEST-00-LOCAL-WHITELIST.conf.example rules/REQUEST-00-LOCAL-WHITELIST.conf
</span></span><span style=display:flex><span>mv rules/RESPONSE-99-EXCEPTIONS.conf.example rules/RESPONSE-99-EXCEPTIONS.conf
</span></span></code></pre></div><h2 id=proceeding-with-the-installation>Proceeding with the Installation</h2><p>Both ModSecurity 2.x (via APR) and ModSecurity 3.x support the Include
directive and what it tells the ModSecurity core to do is parse the
additional files for ModSecurity directives. But where do you place this
folder for it to be included? If you were to look at the CRS files,
you&rsquo;d note there are quite a few .conf files. While the names attempt
to do a good job at describing what each file does additional
information is available in the <a href=rules.md>rules</a>
section.</p><h3 id=includes-for-apache>Includes for Apache</h3><p>Apache will include from the Apache Root directory (<code>/etc/httpd/</code>,
<code>/etc/apache2/</code>, or <code>/usr/local/apache2/</code> depending on the envirovment).
Typically we reccomend following the Fedora practice of creating a
folder specificlly for ModSecurity rules. In our example we have named
this modsecurity.d and placed in within the root Apache directory. When
using Apache we can use the wildcard notation to vastly simplify our
rules. Simply copying our cloned directory to our modsecurity.d folder
and specifying the appropertie include directives will allow us to
install OWASP CRS. In the example below we have also included our
<code>modsecurity.conf</code> file which includes reccomended configurations for
ModSecurity</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=display:flex><span><span style=color:#f92672>&lt;IfModule</span> <span style=color:#e6db74>security2_module</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        Include modsecurity.d/modsecurity.conf
</span></span><span style=display:flex><span>        Include modsecurity.d/owasp-modsecurity-crs/csr-setup.conf
</span></span><span style=display:flex><span>        Include modsecurity.d/owsp-modsecurity-crs/rules/*.conf
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/IfModule&gt;</span>
</span></span></code></pre></div><h3 id=includes-for-nginx>Includes for Nginx</h3><p>Nginx will include from the Nginx conf directory (<code>/usr/local/nginx/conf/</code>
depending on the envirovment). Because only one <code>ModSecurityConfig</code>
directive can be specified within nginx.conf we reccomend naming that
file <code>modsec_includes.conf</code> and including additional files from there. In
the example below we copied our cloned <code>owasp-modsecurity-crs</code> folder into
our Nginx configuration directory. From there we specifying the
appropertie include directives which will include OWASP CRS when the
server is restarted. In the example below we have also included our
<code>modsecurity.conf</code> file which includes reccomended configurations for
ModSecurity</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>include</span> modsecurity.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/csr-setup.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-00-LOCAL-WHITELIST.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-01-COMMON-EXCEPTIONS.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-10-IP-REPUTATION.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-11-METHOD-ENFORCEMENT.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-12-DOS-PROTECTION.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-13-SCANNER-DETECTION.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-20-PROTOCOL-ENFORCEMENT.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-21-PROTOCOL-ATTACK.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-30-APPLICATION-ATTACK-LFI.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-31-APPLICATION-ATTACK-RFI.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-32-APPLICATION-ATTACK-RCE.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-33-APPLICATION-ATTACK-PHP.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-41-APPLICATION-ATTACK-XSS.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-42-APPLICATION-ATTACK-SQLI.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-43-APPLICATION-ATTACK-SESSION-FIXATION.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/REQUEST-49-BLOCKING-EVALUATION.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/RESPONSE-50-DATA-LEAKAGES-IIS.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/RESPONSE-50-DATA-LEAKAGES-JAVA.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/RESPONSE-50-DATA-LEAKAGES-PHP.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/RESPONSE-50-DATA-LEAKAGES.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/RESPONSE-51-DATA-LEAKAGES-SQL.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/RESPONSE-59-BLOCKING-EVALUATION.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/RESPONSE-80-CORRELATION.conf
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> owasp-modsecurity-crs/rules/RESPONSE-99-EXCEPTIONS.conf
</span></span></code></pre></div><h2 id=setting-up-automated-updates>Setting up automated updates</h2><p>todo: The OWASP Core Rule Set is designed with the capability to be
frequently updated in mind. New threats and techniques and updates are
provided frequently as part of the rule set and as a result, in order to
combat the latest threats effectivly it is imperative that constant
updates should be part of your strategy.</p><h3 id=an-update-script>An update script</h3><p>As part of our continuing effort to provide the most user friendly rule
set available we provide an example script that you can use for updating
your ruleset:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>This script is designed to allow users to automatically
</span></span></span><span style=display:flex><span><span style=color:#e6db74>update their ModSecurity OWASP Core Rule Set. It can
</span></span></span><span style=display:flex><span><span style=color:#e6db74>be called by a cronjob or scheduled task in order to
</span></span></span><span style=display:flex><span><span style=color:#e6db74>allow for automation. Note that it can either replace
</span></span></span><span style=display:flex><span><span style=color:#e6db74>the whole CRS directory or just update the rules folder,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>which is the default.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> __future__ <span style=color:#f92672>import</span> print_function
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> argparse
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> uuid
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> shutil
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> git <span style=color:#f92672>import</span> Repo
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ImportError</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;This script requires the GitPython module (pip install gitpython).&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>__author__ <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Chaim Sanders&#34;</span>
</span></span><span style=display:flex><span>__copyright__ <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Copyright 2016, Trustwave Inc&#34;</span>
</span></span><span style=display:flex><span>__credits__ <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;Chaim Sanders&#34;</span>]
</span></span><span style=display:flex><span>__license__ <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ASL 2.0&#34;</span>
</span></span><span style=display:flex><span>__version__ <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1.0&#34;</span>
</span></span><span style=display:flex><span>__maintainer__ <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Chaim Sanders&#34;</span>
</span></span><span style=display:flex><span>__git__ <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;csanders-git&#34;</span>
</span></span><span style=display:flex><span>__status__ <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Production&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check_arguments</span>(logger):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Control arguments and set args variable&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    example_string <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Examples: python </span><span style=color:#e6db74>%(prog)s</span><span style=color:#e6db74> --full -p ./owasp-modsecurity-crs/&#34;</span> \
</span></span><span style=display:flex><span>                     <span style=color:#e6db74>&#34; or python </span><span style=color:#e6db74>%(prog)s</span><span style=color:#e6db74> --folder=util/ --path=./owasp-modsecurity-crs/util&#34;</span> \
</span></span><span style=display:flex><span>                     <span style=color:#e6db74>&#34; or python </span><span style=color:#e6db74>%(prog)s</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    parser <span style=color:#f92672>=</span> argparse<span style=color:#f92672>.</span>ArgumentParser(description<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Update OWASP CRS rules&#39;</span>,
</span></span><span style=display:flex><span>                                     formatter_class<span style=color:#f92672>=</span>argparse<span style=color:#f92672>.</span>ArgumentDefaultsHelpFormatter,
</span></span><span style=display:flex><span>                                     epilog<span style=color:#f92672>=</span>example_string)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;-b&#39;</span>, <span style=color:#e6db74>&#39;--branch&#39;</span>, default<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;v3.0.0-rc1&#34;</span>, type<span style=color:#f92672>=</span>str,
</span></span><span style=display:flex><span>                        required<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;The GitHub branch you want to download.&#39;</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;-r&#39;</span>, <span style=color:#e6db74>&#39;--repo&#39;</span>,
</span></span><span style=display:flex><span>                        default<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://github.com/SpiderLabs/owasp-modsecurity-crs&#34;</span>,
</span></span><span style=display:flex><span>                        type<span style=color:#f92672>=</span>str, required<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;The GitHub repository you want to use.&#39;</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;-p&#39;</span>, <span style=color:#e6db74>&#39;--path&#39;</span>, default<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;./owasp-modsecurity-crs/rules/&#34;</span>, type<span style=color:#f92672>=</span>str,
</span></span><span style=display:flex><span>                        required<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;The path where the rules files should be placed&#39;</span>)
</span></span><span style=display:flex><span>    group <span style=color:#f92672>=</span> parser<span style=color:#f92672>.</span>add_mutually_exclusive_group(required<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    group<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--full&#39;</span>, action<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;store_true&#39;</span>,
</span></span><span style=display:flex><span>                       required<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>                       help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Copy the whole repo to the path specified instead of just the rules&#39;</span>)
</span></span><span style=display:flex><span>    group<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--folder&#39;</span>, default<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rules/&#34;</span>, type<span style=color:#f92672>=</span>str,
</span></span><span style=display:flex><span>                       required<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>                       help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;The toplevel folder within the repo to copy. Can</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>t be used with full&#39;</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;-d&#39;</span>, <span style=color:#e6db74>&#39;--debug&#39;</span>, action<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;store_true&#39;</span>,
</span></span><span style=display:flex><span>                        required<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Display debug logging.&#39;</span>)
</span></span><span style=display:flex><span>    args <span style=color:#f92672>=</span> parser<span style=color:#f92672>.</span>parse_args()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> args<span style=color:#f92672>.</span>debug:
</span></span><span style=display:flex><span>        logger<span style=color:#f92672>.</span>setLevel(logging<span style=color:#f92672>.</span>DEBUG)
</span></span><span style=display:flex><span>        logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Debugging mode has been enabled.&#34;</span>)
</span></span><span style=display:flex><span>    logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;The following arguments were assigned: &#34;</span> <span style=color:#f92672>+</span> str(args) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> args
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>download_rules</span>(args, logger):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Download and replace our rules&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> args<span style=color:#f92672>.</span>path[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>!=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>sep:
</span></span><span style=display:flex><span>        dst_dir <span style=color:#f92672>=</span> args<span style=color:#f92672>.</span>path <span style=color:#f92672>+</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>sep
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        dst_dir <span style=color:#f92672>=</span> args<span style=color:#f92672>.</span>path
</span></span><span style=display:flex><span>    logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;The final path was set to &#34;</span> <span style=color:#f92672>+</span> str(dst_dir) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span>)
</span></span><span style=display:flex><span>    rand_fold <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;./&#34;</span> <span style=color:#f92672>+</span> str(uuid<span style=color:#f92672>.</span>uuid4())
</span></span><span style=display:flex><span>    logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;The temporary repo folder was set to &#34;</span> <span style=color:#f92672>+</span> str(rand_fold) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e># If the user wants the whole directory set that otherwise just rules/</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> args<span style=color:#f92672>.</span>full:
</span></span><span style=display:flex><span>        copy_fold <span style=color:#f92672>=</span> rand_fold
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        copy_fold <span style=color:#f92672>=</span> rand_fold <span style=color:#f92672>+</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>sep <span style=color:#f92672>+</span> args<span style=color:#f92672>.</span>folder
</span></span><span style=display:flex><span>    logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Set the folder to be copied to &#34;</span> <span style=color:#f92672>+</span> copy_fold <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span>)
</span></span><span style=display:flex><span>    Repo<span style=color:#f92672>.</span>clone_from(args<span style=color:#f92672>.</span>repo, rand_fold, branch<span style=color:#f92672>=</span>(args<span style=color:#f92672>.</span>branch))
</span></span><span style=display:flex><span>    logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Cloned the repo successfully.&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> src_dir, _, files <span style=color:#f92672>in</span> os<span style=color:#f92672>.</span>walk(copy_fold):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> file_ <span style=color:#f92672>in</span> files:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> file_[<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span>:] <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;.example&#34;</span>:
</span></span><span style=display:flex><span>                src_file <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(src_dir, file_)
</span></span><span style=display:flex><span>                <span style=color:#75715e># If its the full copy we need the new prefix path</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> args<span style=color:#f92672>.</span>full:
</span></span><span style=display:flex><span>                    copy_path <span style=color:#f92672>=</span> src_file<span style=color:#f92672>.</span>replace(rand_fold, <span style=color:#e6db74>&#34;&#34;</span>)[<span style=color:#ae81ff>1</span>:]
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                    <span style=color:#75715e># Remove the overlap in folders</span>
</span></span><span style=display:flex><span>                    copy_path <span style=color:#f92672>=</span> src_file<span style=color:#f92672>.</span>replace(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(rand_fold, args<span style=color:#f92672>.</span>folder), <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>                dst_file <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(dst_dir, copy_path)
</span></span><span style=display:flex><span>                cwd <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>dirname(dst_file)
</span></span><span style=display:flex><span>                <span style=color:#75715e># Check if the directory structure exists</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(cwd):
</span></span><span style=display:flex><span>                    os<span style=color:#f92672>.</span>makedirs(cwd)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(dst_file):
</span></span><span style=display:flex><span>                    os<span style=color:#f92672>.</span>remove(dst_file)
</span></span><span style=display:flex><span>                    logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Removed existing &#34;</span> <span style=color:#f92672>+</span> dst_file <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                    shutil<span style=color:#f92672>.</span>move(src_file, cwd)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>except</span> shutil<span style=color:#f92672>.</span>Error <span style=color:#66d9ef>as</span> exc:
</span></span><span style=display:flex><span>                    print(exc)
</span></span><span style=display:flex><span>                logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Moved &#34;</span> <span style=color:#f92672>+</span> file_ <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; to &#34;</span> <span style=color:#f92672>+</span> cwd <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span>)
</span></span><span style=display:flex><span>    logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Copying completed successfully&#34;</span>)
</span></span><span style=display:flex><span>    shutil<span style=color:#f92672>.</span>rmtree(rand_fold)
</span></span><span style=display:flex><span>    logger<span style=color:#f92672>.</span>debug(<span style=color:#e6db74>&#34;Deleted the temporary folder.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Initiate logging and run subroutines&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    logging<span style=color:#f92672>.</span>basicConfig(level<span style=color:#f92672>=</span>logging<span style=color:#f92672>.</span>INFO)
</span></span><span style=display:flex><span>    logger <span style=color:#f92672>=</span> logging<span style=color:#f92672>.</span>getLogger(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>basename(__file__))
</span></span><span style=display:flex><span>    args <span style=color:#f92672>=</span> check_arguments(logger)
</span></span><span style=display:flex><span>    download_rules(args, logger)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><h2 id=problems-with-installation>Problems with installation</h2><h3 id=apache-line-continuation>Apache Line Continuation</h3><p>In Apache 2.4.x before 2.4.11 there is a bug where the use of line
continuations in a config size may cause the line continuation to be
truncated. This will lead to an error similar to the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Syntax error on line <span style=color:#ae81ff>24</span> of /etc/httpd/modsecurity.d/activated_rules/RESPONSE-50-DATA-LEAKAGES-PHP.conf:
</span></span><span style=display:flex><span>Error parsing actions: Unknown action: <span style=color:#ae81ff>\
</span></span></span></code></pre></div><p>This is not an error with ModSecurity or OWASP CRS. In order to fix this
issue you can simply add a space before the continuation on the
offending line. For more information see <a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55910">apache bugzilla</a>.</p><h3 id=anomaly-mode-doesnt-work>Anomaly Mode Doesn&rsquo;t Work</h3><p>Sometimes on IIS or Nginx users run into an instance where anamoly mode
doesn&rsquo;t work as expected. In fact upon careful inspection of logs one
would notice that rules don&rsquo;t fire in the order we would expect. In
general this is a result of using the <code>'*'</code> operator within these
environments as it does not act the same way as in Apache. In general
within both Apache and IIS one should expliticly include the various
files present within the OWASP CRS instead of using the <code>'*'</code>.</p><h3 id=webserver-returns-error-after-crs-install>Webserver returns error after CRS install</h3><p>This is likley due to a rule triggering. For instance in some cases a
rule is enabled that prohibits access via an IP address. Depending on
your
<a href=https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual-(v2.x)#SecDefaultAction>SecDefaultAction</a>
and
<a href=https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual-(v2.x)#SecRuleEngine>SecRuleEngine</a>
configurations, this may result in a redirect loop or a status code. If
this is the problem you are experiencing you should consult your
error.log (or event viewer for IIS). From this location you can
determine the offending rule and add an exception if neccessary see
<a href=https://coreruleset.github.io/documentation/configuring/false_positives_tuning/>false positives and tuning</a>.</p><footer class=footline></footer></article></div></main></div><aside id=sidebar class="default-animation showVisitedLinks"><div id=header-wrapper class=default-animation><div id=header class=default-animation><a id=logo href=https://coreruleset.github.io/documentation/><img src=https://coreruleset.github.io/documentation//images/logo.png></a></div><div class="searchbox default-animation"><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script src=/documentation/js/lunr.min.js?1650832653></script>
<script src=/documentation/js/auto-complete.js?1650832653></script>
<script src=/documentation/js/search.js?1650832653></script></div><div id=homelinks class=default-animation><ul><li><a class=padding href=/documentation/><i class="fas fa-home"></i> Home</a></li></ul></div><div id=content-wrapper class=highlightable><ul class=topics><li data-nav-id=/documentation/deployment/ title="Getting CRS" class="dd-item parent"><input type=checkbox id=section-9196179b4df48fe4f393bf8626001e89 class=toggle checked><label for=section-9196179b4df48fe4f393bf8626001e89></label><a href=/documentation/deployment/><b>1. </b>Getting CRS<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/deployment/engine_integration_options/ title="Engine and Integration Options" class=dd-item><a href=/documentation/deployment/engine_integration_options/>Engine and Integration Options<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/deployment/quickstart/ title="OWASP CRS Quickstart" class=dd-item><a href=/documentation/deployment/quickstart/>Quickstart<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/deployment/install/ title="Installing CoreRuleSet" class="dd-item active"><a href=/documentation/deployment/install/>Extended Install<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/configuring/ title="How it Works" class=dd-item><input type=checkbox id=section-e64e361515172711b81c70daddef15db class=toggle><label for=section-e64e361515172711b81c70daddef15db></label><a href=/documentation/configuring/><b>2. </b>How it Works<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/configuring/anomaly_scoring/ title="Anomaly Scoring" class=dd-item><a href=/documentation/configuring/anomaly_scoring/>Anomaly Scoring<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/configuring/paranoia_levels/ title="Paranoia Levels" class=dd-item><a href=/documentation/configuring/paranoia_levels/>Paranoia Levels<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/configuring/false_positives_tuning/ title="False Positives and Tuning" class=dd-item><a href=/documentation/configuring/false_positives_tuning/>False Positives and Tuning<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/configuring/plugins/ title="Plugin Mechanism" class=dd-item><a href=/documentation/configuring/plugins/>Plugin Mechanism<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/configuring/sampling_mode/ title="Sampling Mode" class=dd-item><a href=/documentation/configuring/sampling_mode/>Sampling Mode<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/configuring/crs/ title=Configuration class=dd-item><a href=/documentation/configuring/crs/>Configuration<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/operation/ title=Operation class=dd-item><input type=checkbox id=section-1e77c265d0f1eb19f76aa47f8d696754 class=toggle><label for=section-1e77c265d0f1eb19f76aa47f8d696754></label><a href=/documentation/operation/><b>3. </b>Operation<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/operation/containers/ title="Using Containers" class=dd-item><a href=/documentation/operation/containers/>Using Containers<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/operation/log_handling/ title="Log Handling" class=dd-item><a href=/documentation/operation/log_handling/>Log Handling<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/operation/known_issues/ title="Known Issues" class=dd-item><a href=/documentation/operation/known_issues/>Known Issues<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/rules/ title="Creating Rules" class=dd-item><input type=checkbox id=section-f67a6dce8cc0d0f579129273e1cdbb1f class=toggle><label for=section-f67a6dce8cc0d0f579129273e1cdbb1f></label><a href=/documentation/rules/><b>4. </b>Rules<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/rules/ruleid/ title="Rule IDs" class=dd-item><a href=/documentation/rules/ruleid/><b>1. </b>Rule IDs<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/testing/ title="Testing the Rule Set" class=dd-item><a href=/documentation/rules/testing/><b>2. </b>Testing<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/rules/ title=Rules class=dd-item><a href=/documentation/rules/rules/><b>4. </b>Rules<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/creating/ title=Making class=dd-item><a href=/documentation/rules/creating/><b>9. </b>Making<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/metadata/ title=Metadata class=dd-item><a href=/documentation/rules/metadata/><b>10. </b>Metadata<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/development/ title=Development class=dd-item><input type=checkbox id=section-fbb3e40f0f1b6648c2ac6280ed066d74 class=toggle><label for=section-fbb3e40f0f1b6648c2ac6280ed066d74></label><a href=/documentation/development/><b>5. </b>Development<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/development/contribution_guidelines/ title="Contribution Guidelines" class=dd-item><a href=/documentation/development/contribution_guidelines/>Contribution Guidelines<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/useful_tools/ title="Useful Tools" class=dd-item><a href=/documentation/development/useful_tools/>Useful Tools<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/testing/ title="Testing the Rule Set" class=dd-item><a href=/documentation/development/testing/>Testing the Rule Set<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/plugin_writing/ title="Writing Plugins" class=dd-item><a href=/documentation/development/plugin_writing/>Writing Plugins<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/sandbox/ title="Using the CRS Sandbox" class=dd-item><a href=/documentation/development/sandbox/>Using the CRS Sandbox<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/resources/ title="Additional Resources" class=dd-item><a href=/documentation/resources/><b>6. </b>Additional Resources<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/miscellaneous/ title=Miscellaneous class=dd-item><input type=checkbox id=section-78bdcd2250f681f81a1dbc45c9a15123 class=toggle><label for=section-78bdcd2250f681f81a1dbc45c9a15123></label><a href=/documentation/miscellaneous/><b>7. </b>Miscellaneous<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/miscellaneous/self_contained_mode/ title="Self-Contained Mode" class=dd-item><a href=/documentation/miscellaneous/self_contained_mode/>Self-Contained Mode<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><div id=shortcuts><div class=nav-title>More</div><ul><li><a class=padding href=https://coreruleset.org/><i class="fas fa-bookmark"></i> Core Rule Set Home</a></li><li><a class=padding href=https://github.com/coreruleset/coreruleset><i class="fab fa-github"></i> Core Rule Set GitHub</a></li></ul></div><div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"></div><hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"><div id=prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVisitedLinks"><ul><li id=select-language-container class=footerLangSwitch><a class="padding select-container"><i class="fas fa-language fa-fw"></i>
<span>&nbsp;</span><div class=select-style><select id=select-language onchange="location=baseUri+this.value"></select></div><div class=select-clear></div></a></li><li id=select-variant-container class=footerVariantSwitch><a class="padding select-container"><i class="fas fa-paint-brush fa-fw"></i>
<span>&nbsp;</span><div class=select-style><select id=select-variant onchange=variants.changeVariant(this.value)><option id=blue value=blue selected>Blue</option></select></div><div class=select-clear></div></a><script>variants.markSelectedVariant()</script></li><li class="footerVisitedLinks showVisitedLinks"><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></div><div id=footer class="footerFooter showFooter"><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></aside><script src=/documentation/js/clipboard.min.js?1650832653></script>
<script src=/documentation/js/perfect-scrollbar.min.js?1650832653></script>
<script src=/documentation/js/featherlight.min.js?1650832653></script>
<script src=/documentation/js/theme.js?1650832653></script>
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://piwik.netnea.com/matomo/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","4"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script><img referrerpolicy=no-referrer-when-downgrade src="https://piwik.netnea.com/matomo/matomo.php?idsite=4&rec=1" style=border:0 alt></body></html>